(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();const m={hiragana:[{title:"Main",groups:[{title:"a",letters:[{romanji:"a",letter:"あ"},{romanji:"i",letter:"い"},{romanji:"u",letter:"う"},{romanji:"e",letter:"え"},{romanji:"o",letter:"お"}]},{title:"k-",letters:[{romanji:"ka",letter:"か"},{romanji:"ki",letter:"き"},{romanji:"ku",letter:"く"},{romanji:"ke",letter:"け"},{romanji:"ko",letter:"こ"}]},{title:"s-",letters:[{romanji:"sa",letter:"さ"},{romanji:"shi",letter:"し"},{romanji:"su",letter:"す"},{romanji:"se",letter:"せ"},{romanji:"so",letter:"そ"}]},{title:"t-",letters:[{romanji:"ta",letter:"た"},{romanji:"chi",letter:"ち"},{romanji:"tsu",letter:"つ"},{romanji:"te",letter:"て"},{romanji:"to",letter:"と"}]},{title:"n-",letters:[{romanji:"na",letter:"な"},{romanji:"ni",letter:"に"},{romanji:"nu",letter:"ぬ"},{romanji:"ne",letter:"ね"},{romanji:"no",letter:"の"}]},{title:"h-",letters:[{romanji:"ha",letter:"は"},{romanji:"hi",letter:"ひ"},{romanji:"fu",letter:"ふ"},{romanji:"he",letter:"へ"},{romanji:"ho",letter:"ほ"}]},{title:"m-",letters:[{romanji:"ma",letter:"ま"},{romanji:"mi",letter:"み"},{romanji:"mu",letter:"む"},{romanji:"me",letter:"め"},{romanji:"mo",letter:"も"}]},{title:"y-",letters:[{romanji:"ya",letter:"や"},{romanji:"yu",letter:"ゆ"},{romanji:"yo",letter:"よ"}]},{title:"r-",letters:[{romanji:"ra",letter:"ら"},{romanji:"ri",letter:"り"},{romanji:"ru",letter:"る"},{romanji:"re",letter:"れ"},{romanji:"ro",letter:"ろ"}]},{title:"w-",letters:[{romanji:"wa",letter:"わ"},{romanji:"wo",letter:"を"}]},{title:"n",letters:[{romanji:"n",letter:"ん"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{romanji:"ga",letter:"が"},{romanji:"gi",letter:"ぎ"},{romanji:"gu",letter:"ぐ"},{romanji:"ge",letter:"げ"},{romanji:"go",letter:"ご"}]},{title:"z-",letters:[{romanji:"za",letter:"ざ"},{romanji:"ji",letter:"じ"},{romanji:"zu",letter:"ず"},{romanji:"ze",letter:"ぜ"},{romanji:"zo",letter:"ぞ"}]},{title:"d-",letters:[{romanji:"da",letter:"だ"},{romanji:"di",letter:"ぢ"},{romanji:"du",letter:"づ"},{romanji:"de",letter:"で"},{romanji:"do",letter:"ど"}]},{title:"b-",letters:[{romanji:"ba",letter:"ば"},{romanji:"bi",letter:"び"},{romanji:"bu",letter:"ぶ"},{romanji:"be",letter:"べ"},{romanji:"bo",letter:"ぼ"}]},{title:"p-",letters:[{romanji:"pa",letter:"ぱ"},{romanji:"pi",letter:"ぴ"},{romanji:"pu",letter:"ぷ"},{romanji:"pe",letter:"ぺ"},{romanji:"po",letter:"ぽ"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{romanji:"kya",letter:"きゃ"},{romanji:"kyu",letter:"きゅ"},{romanji:"kyo",letter:"きょ"}]},{title:"sh-",letters:[{romanji:"sha",letter:"しゃ"},{romanji:"shu",letter:"しゅ"},{romanji:"sho",letter:"しょ"}]},{title:"ch-",letters:[{romanji:"cha",letter:"ちゃ"},{romanji:"chu",letter:"ちゅ"},{romanji:"cho",letter:"ちょ"}]},{title:"ny-",letters:[{romanji:"nya",letter:"にゃ"},{romanji:"nyu",letter:"にゅ"},{romanji:"nyo",letter:"にょ"}]},{title:"hy-",letters:[{romanji:"hya",letter:"ひゃ"},{romanji:"hyu",letter:"ひゅ"},{romanji:"hyo",letter:"ひょ"}]},{title:"my-",letters:[{romanji:"mya",letter:"みゃ"},{romanji:"myu",letter:"みゅ"},{romanji:"myo",letter:"みょ"}]},{title:"ry-",letters:[{romanji:"rya",letter:"りゃ"},{romanji:"ryu",letter:"りゅ"},{romanji:"ryo",letter:"りょ"}]},{title:"gy-",letters:[{romanji:"gya",letter:"ぎょ"},{romanji:"gyu",letter:"ぎゅ"},{romanji:"gyo",letter:"ぎょ"}]},{title:"jy-",letters:[{romanji:"jya",letter:"じゃ"},{romanji:"jyu",letter:"じゅ"},{romanji:"jyo",letter:"じょ"}]},{title:"by-",letters:[{romanji:"bya",letter:"びゃ"},{romanji:"byu",letter:"びゅ"},{romanji:"byo",letter:"びょ"}]},{title:"py-",letters:[{romanji:"pya",letter:"ぴゃ"},{romanji:"pyu",letter:"ぴゅ"},{romanji:"pyo",letter:"ぴょ"}]}]}],katakana:[{title:"Main",groups:[{title:"a",letters:[{letter:"ア",romanji:"a"},{letter:"イ",romanji:"i"},{letter:"ウ",romanji:"u"},{letter:"エ",romanji:"e"},{letter:"オ",romanji:"o"}]},{title:"k-",letters:[{letter:"カ",romanji:"ka"},{letter:"キ",romanji:"ki"},{letter:"ク",romanji:"ku"},{letter:"ケ",romanji:"ke"},{letter:"コ",romanji:"ko"}]},{title:"s-",letters:[{letter:"サ",romanji:"sa"},{letter:"シ",romanji:"shi"},{letter:"ス",romanji:"su"},{letter:"セ",romanji:"se"},{letter:"ソ",romanji:"so"}]},{title:"t-",letters:[{letter:"タ",romanji:"ta"},{letter:"チ",romanji:"chi"},{letter:"ツ",romanji:"tsu"},{letter:"テ",romanji:"te"},{letter:"ト",romanji:"to"}]},{title:"n-",letters:[{letter:"ナ",romanji:"na"},{letter:"ニ",romanji:"ni"},{letter:"ヌ",romanji:"nu"},{letter:"ネ",romanji:"ne"},{letter:"ノ",romanji:"no"}]},{title:"h-",letters:[{letter:"ハ",romanji:"ha"},{letter:"ヒ",romanji:"hi"},{letter:"フ",romanji:"fu"},{letter:"ヘ",romanji:"he"},{letter:"ホ",romanji:"ho"}]},{title:"m-",letters:[{letter:"マ",romanji:"ma"},{letter:"ミ",romanji:"mi"},{letter:"ム",romanji:"mu"},{letter:"メ",romanji:"me"},{letter:"モ",romanji:"mo"}]},{title:"y-",letters:[{letter:"ヤ",romanji:"ya"},{letter:"ユ",romanji:"yu"},{letter:"ヨ",romanji:"yo"}]},{title:"r-",letters:[{letter:"ラ",romanji:"ra"},{letter:"リ",romanji:"ri"},{letter:"ル",romanji:"ru"},{letter:"レ",romanji:"re"},{letter:"ロ",romanji:"ro"}]},{title:"w-",letters:[{letter:"ワ",romanji:"wa"},{letter:"ヲ",romanji:"wo"}]},{title:"n",letters:[{letter:"ン",romanji:"n"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{letter:"ガ",romanji:"ga"},{letter:"ギ",romanji:"gi"},{letter:"グ",romanji:"gu"},{letter:"ゲ",romanji:"ge"},{letter:"ゴ",romanji:"go"}]},{title:"z-",letters:[{letter:"ザ",romanji:"za"},{letter:"ジ",romanji:"zi"},{letter:"ズ",romanji:"zu"},{letter:"ゼ",romanji:"ze"},{letter:"ゾ",romanji:"zo"}]},{title:"d-",letters:[{letter:"ダ",romanji:"da"},{letter:"ヂ",romanji:"di"},{letter:"ヅ",romanji:"du"},{letter:"デ",romanji:"de"},{letter:"ド",romanji:"do"}]},{title:"b-",letters:[{letter:"バ",romanji:"ba"},{letter:"ビ",romanji:"bi"},{letter:"ブ",romanji:"bu"},{letter:"ベ",romanji:"be"},{letter:"ボ",romanji:"bo"}]},{title:"p-",letters:[{letter:"パ",romanji:"pa"},{letter:"ピ",romanji:"pi"},{letter:"プ",romanji:"pu"},{letter:"ペ",romanji:"pe"},{letter:"ポ",romanji:"po"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{letter:"キャ",romanji:"kya"},{letter:"キュ",romanji:"kyu"},{letter:"キョ",romanji:"kyo"}]},{title:"sh-",letters:[{letter:"シャ",romanji:"sha"},{letter:"シュ",romanji:"shu"},{letter:"ショ",romanji:"sho"}]},{title:"ch-",letters:[{letter:"チャ",romanji:"cha"},{letter:"チュ",romanji:"chu"},{letter:"チョ",romanji:"cho"}]},{title:"ny-",letters:[{letter:"ニャ",romanji:"nya"},{letter:"ニュ",romanji:"nyu"},{letter:"ニョ",romanji:"nyo"}]},{title:"hy-",letters:[{letter:"ヒャ",romanji:"hya"},{letter:"ヒュ",romanji:"hyu"},{letter:"ヒョ",romanji:"hyo"}]},{title:"my-",letters:[{letter:"ミャ",romanji:"mya"},{letter:"ミュ",romanji:"myu"},{letter:"ミョ",romanji:"myo"}]},{title:"ry-",letters:[{letter:"リャ",romanji:"rya"},{letter:"リュ",romanji:"ryu"},{letter:"リョ",romanji:"ryo"}]},{title:"gy-",letters:[{letter:"ギャ",romanji:"gya"},{letter:"ギュ",romanji:"gyu"},{letter:"ギョ",romanji:"gyo"}]},{title:"jy-",letters:[{letter:"jヤ",romanji:"jya"},{letter:"jユ",romanji:"jyu"},{letter:"jヨ",romanji:"jyo"}]},{title:"by-",letters:[{letter:"ビャ",romanji:"bya"},{letter:"ビュ",romanji:"byu"},{letter:"ビョ",romanji:"byo"}]},{title:"py-",letters:[{letter:"ピャ",romanji:"pya"},{letter:"ピュ",romanji:"pyu"},{letter:"ピョ ",romanji:"pyo"}]}]}]},U={negative:["Nope!","Try again!","Not like this!"],positive:["Good job!","Correct!","Nice!"]};let p=0,f=Object.keys(m)[p];const _=e=>{p=e,f=Object.keys(m)[p]},G=[{short:"TT",title:"Time Trials",description:"Limit how much time you have to name a character. 0 to disable"},{short:"KT",title:"Keep Trying",description:"Retry each character until you name it correctly"},{short:"PF",title:"Perfect",description:"Restart if you make a single mistake"},{short:"R",title:"Random",description:"Shuffle characters"},{short:"ZE",title:"Zen",description:"Just type the charactes, forever. Always random"}],ee=[10,25,50,75,100],L=e=>{let t=0;for(const r of e.history)t+=r.isCorrect?1:0;return t/e.history.length*100},te=[{text:"F",longText:"Fail",condition:e=>e.failed},{text:"",longText:"",condition:e=>{if(window.forceX)return!0;if(d.size<25)return!1;for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"SS",longText:"Perfect",condition:e=>{for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"S",longText:"Almost there",condition:e=>L(e)>95},{text:"A",longText:"Good job",condition:e=>L(e)>90},{text:"B",longText:"Keep going",condition:e=>L(e)>80},{text:"C",longText:"I'm done with long text for now",condition:e=>L(e)>70},{text:"D",longText:"I'm done with long text for now",condition:()=>!0}],re=[{text:"☆",condition:e=>!!e.mods?.includes("PF")},{text:"+",condition:e=>!!e.mods?.includes("KT")},{text:"꩜",condition:e=>!!e.mods?.includes("R")}],ne=[{text:"Ascended",style:"font-size: 2.5rem;font-weight: 900;letter-spacing: 2px;text-transform: uppercase;background: linear-gradient(270deg, #00ffe0, #ff00c8, #ffd700, #00ffe0);background-size: 800% 800%;-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: pulseGradient 6s ease infinite, glowPulse 2s ease-in-out infinite;text-shadow:0 0 10px rgba(255,255,255,0.9),0 0 20px rgba(0,255,255,0.6),0 0 30px rgba(255,0,255,0.6);border: 2px solid rgba(255,255,255,0.2);border-radius: 12px;padding: 0.5rem 1rem;box-shadow:0 0 15px rgba(255,255,255,0.1),0 0 25px rgba(0,255,255,0.3);display: inline-block;",condition:e=>!!(window.forceX||d.size>=25&&e.timeTrials&&e.timeTrials<=1&&e.mods.includes("PF")&&e.mods.includes("R")&&e.mods.includes("KT"))},{text:"Divine",style:"font-weight: 800;background: linear-gradient(90deg, #ff6ec4, #7873f5, #4ac29a);-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: shine 3s infinite linear;text-shadow: 0 0 8px rgba(255,255,255,0.6);",condition:e=>!!(e.timeTrials&&e.timeTrials<=2&&e.mods.includes("PF"))},{text:"Mythical",style:"color: crimson; font-weight: bold; text-shadow: 0 0 8px red;",condition:e=>!!(e.timeTrials&&e.timeTrials<=2.5&&e.mods.includes("PF"))},{text:"Godspeed",style:"color: #ff4081; font-style: italic; text-shadow: 0 0 5px #ff4081;",condition:e=>!!(e.timeTrials&&e.timeTrials<=3&&e.mods.includes("PF"))},{text:"Elite",style:"color: gold; font-weight: bold; text-shadow: 1px 1px 4px #b8860b;",condition:e=>!!(e.timeTrials&&e.timeTrials<=4&&e.mods.includes("PF"))},{text:"Sharp",style:"color: #4caf50; font-weight: 600; text-shadow: 0 0 5px #4caf50;",condition:e=>!!(e.timeTrials&&e.timeTrials<=5&&e.mods.includes("PF"))},{text:"Swift",style:"color: #00bcd4; font-style: italic;",condition:e=>!!(e.timeTrials&&e.timeTrials<=7&&e.mods.includes("PF"))},{text:"Quick",style:"color: #5bc0de; font-weight: bold;",condition:e=>!!(e.timeTrials&&e.timeTrials<=9&&e.mods.includes("PF"))},{text:"Casual",style:"color: gray;",condition:e=>!!(e.timeTrials&&e.timeTrials<=10&&e.mods.includes("PF"))}],X=e=>{let t=e.length;for(;t!=0;){let r=Math.floor(Math.random()*t);t--,[e[t],e[r]]=[e[r],e[t]]}},J=e=>e[Math.floor(Math.random()*e.length)];let D="main";const S={MAIN:0,TEST:1,RESULTS:2},x=[document.getElementById("content"),document.getElementById("actualTest"),document.getElementById("resultsScreen")],g=e=>{switch(x.forEach(t=>{t?.classList.add("hidden")}),D=e,e){case"main":x[S.MAIN]?.classList.remove("hidden");break;case"test":x[S.TEST]?.classList.remove("hidden");break;case"results":x[S.RESULTS]?.classList.remove("hidden");break}},I=(e,t)=>{for(const r of Object.keys(m))for(const n of m[r])for(const o of n.groups)for(const l of o.letters)if(l.romanji==t)return l.letter},R=(e,t)=>{let r="";for(const n of te)if(n.condition(e)){r=n.text;break}for(const n of ne){if(e.failed)break;if(n.condition(e)){r=`${n.text} ${r}`,t&&(t.style=n.style);break}}for(const n of re){if(e.failed)break;if(r.startsWith("Ascended")){r.trimEnd();break}if(n.condition(e)){r=r+n.text;break}}return t&&(t.innerHTML=r),r},oe=()=>{document.querySelector(".alphabetSubGroup")?.classList.contains("selected")?F("off"):F("on")},Q=()=>{const e=Object.keys(m),t=p+1>=e.length?0:p+1,r=m[f][0].groups[0].letters[0].letter,n=m[e[t]][0].groups[0].letters[0].letter;return`${r} -> ${n}`},F=e=>{document.querySelectorAll(".alphabetSubGroup").forEach(t=>{const r=t.children[0].innerHTML.split(" ")[0];e=="off"?(t.classList.remove("selected"),d.clear()):(t.classList.add("selected"),d.add(r))})},$=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let h=0;const j={},B={};let v=!1;const ie=()=>{document.addEventListener("keydown",e=>{for(const t of Object.keys(j[f]))D=="main"&&(e.key==t&&j[f][t](),t.startsWith("S")&&e.shiftKey&&e.key.toLowerCase()==t.charAt(1)&&j[f][t]());switch(D){case"main":switch(e.code){case"Enter":A();break;case"Escape":H.classList.contains("hidden")||H.classList.add("hidden"),b.classList.contains("hidden")||b.classList.add("hidden");break;case"Space":oe();break;case"F2":b.classList.toggle("hidden");break;case"CapsLock":const t=Object.keys(m),r=p+1>t.length-1?0:p+1;v&&(_(r),document.querySelectorAll(".alphabet").forEach(n=>{n.classList.add("hidden")}),document.getElementById(`${t[r]}Alphabet`).classList.remove("hidden"),d.clear(),F("off")),v=!v,document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>${v?"[Again]":"[Caps Lock]"}`;break}if(!b.classList.contains("hidden")&&e.code.startsWith("Digit")&&document.getElementById("TTSeconds")!=document.activeElement){const t=Number(e.code.slice(-1)),r=n=>{n.checked=!n.checked};if(t>4)return;if(r(document.getElementsByClassName(`Mod${t}`)[0]),t==4)for(let n=0;n<=3;n++)r(document.getElementsByClassName(`Mod${n}`)[0])}if(e.shiftKey&&e.code.startsWith("Digit")&&B[f][Number(e.code.slice(-1))](),!b.classList.contains("hidden")&&e.key=="`"){const t=document.getElementById("TTSeconds");t.focus(),t.value=t.value.replaceAll("`","")}break;case"test":e.code=="Escape"&&(i.mods.includes("ZE")?z():g("main"));break;case"results":e.code=="Tab"&&(e.preventDefault(),A()),e.code=="Escape"&&g("main");break}h>0&&e.key!=$[h]&&(h=0),e.key==$[h]&&h++,h>=$.length&&(window.forceX=!0,h=0)})},d=new Set;let u="";function le(e){const t=()=>{r.classList.toggle("selected")?d.add(e.title):(d.delete(e.title),r.parentElement.classList.remove("selected"))},r=document.createElement("div");r.classList.add("alphabetSubGroup");const n=document.createElement("p");return n.textContent=`${e.title} (${e.letters[0].letter})`,r.appendChild(n),r.addEventListener("click",()=>{t()}),e.title.length<3?j[u][e.title.charAt(0)]=t:j[u]["S"+e.title.charAt(0)]=t,r}function ae(e,t){const r=()=>{const l=n.classList.toggle("selected");for(const a of n.children)a.classList.contains("alphabetSubGroup")&&(l?(a.classList.add("selected"),d.add(a.children[0].innerHTML.split(" ")[0])):(a.classList.remove("selected"),d.delete(a.children[0].innerHTML.split(" ")[0])))},n=document.createElement("div");n.classList.add("alphabetGroup");const o=document.createElement("p");o.textContent=`${e.title} [Shift + ${t+1}]`,n.appendChild(o);for(const l of e.groups){const a=le(l);n.appendChild(a)}return o.addEventListener("click",()=>{r()}),B[u][t+1]=r,n}function se(e,t){const r=document.createElement("div");r.classList.add("alphabet"),r.id=`${e}Alphabet`,u=e,f!=e&&r.classList.add("hidden");const n=document.createElement("p");n.textContent=e,r.appendChild(n),j[u]||(j[u]={}),B[u]||(B[u]=[]);for(const o in t){const l=ae(t[o],Number(o));r.appendChild(l)}return r}const ce=document.getElementById("content"),me=document.getElementById("disclaimer");for(const e of Object.keys(m)){const t=se(e,m[e]);ce.insertBefore(t,me)}document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>[Caps Lock]`;const de=document.getElementById("modsScreen");for(const e in G){const t=G[e];if(t.short=="TT")continue;const r=document.createElement("div"),n=document.createElement("div"),o=document.createElement("p");o.innerHTML=t.title,n.append(o);const l=document.createElement("p");l.innerHTML=`[${Number(e)}]
${t.description}`,n.append(l),r.append(n);const a=document.createElement("input");a.type="checkbox",a.id=`${t.short}Selected`,a.classList.add(`Mod${Number(e)}`),r.append(a),de.append(r)}const K=document.getElementById("comboText"),q=document.getElementById("accuracyText"),Z=document.getElementById("modsDisplay"),T=document.getElementById("actualTest").children[0],k=document.getElementById("resultsRank"),w=document.getElementById("resultsButtons"),ue=document.getElementById("resultsNotes");let M=1e3;const P=e=>new Promise(t=>setTimeout(t,e)),fe=e=>{const t=document.createElement("p");t.innerHTML=e,t.style.opacity="0",t.classList.add("yes-transition"),t.classList.add("transcendedCharacter"),ue.children[0].append(t),requestAnimationFrame(()=>{t.style.opacity="1"})},he=async e=>{K.style.display="none",q.style.display="none",Z.style.display="none",w.style.opacity="0%",w.classList.add("yes-transition"),k.style.opacity="0%",k.classList.add("yes-transition"),T.style.transition="all 2s ease-in-out",T.classList.add("transcendedCard"),T.style.opacity="0%",await P(2e3),g("results");for(const r of Object.keys(e.characters))fe(`${I("letter",r)}: Perfect`),await P(M),M=Math.max(200,M*.9);R(e,k),k.style.opacity="100%",await P(1e3);const t=()=>{T.removeAttribute("style"),T.classList.remove("transcendedCard"),k.removeAttribute("style"),K.removeAttribute("style"),q.removeAttribute("style"),Z.removeAttribute("style")};w.style.opacity="100%",w.addEventListener("click",t)};let c=[],y=0,i={history:[],startTime:0,currentCombo:0,longestCombo:0,characters:{},mods:[]};const E=document.getElementById("comboText"),Y=document.getElementById("accuracyText"),N=document.getElementById("resultsNotes"),W=document.getElementById("modsDisplay"),s=document.getElementById("current");let C;const A=()=>{c=[],y=0;for(const n of m[f])for(const o of n.groups)if(d.has(o.title))for(const l of o.letters)c.push(l);if(c.length==0){g("main");return}N.children[0].innerHTML="",N.children[1].innerHTML="",i={history:[],startTime:Date.now(),currentCombo:0,longestCombo:0,characters:{},mods:[]},["KT","PF","R","ZE"].forEach(n=>{document.getElementById(n+"Selected").checked&&i.mods?.push(n)});const e=Number(document.getElementById("TTSeconds").value);e>0&&(i.mods?.push("TT:"+e),i.timeTrials=e),(i.mods.includes("R")||i.mods.includes("ZE"))&&X(c);const t=document.getElementById("actualTest").children[0],r=t.children[1];t.children[0].innerHTML=c[0].letter,r.value="",E.innerHTML="0x",E.classList="",W.innerHTML="",s.style.border="none",r.value="",i.mods?.forEach(n=>{const o=document.createElement("p");o.innerHTML=n,W?.append(o)}),t.classList.add("no-transition"),t.style.marginLeft="0%",t.offsetWidth,t.classList.remove("no-transition"),g("test"),r.focus(),i.timeTrials&&(C=setTimeout(O,i.timeTrials*1e3))};document.getElementById("romanjiInput").addEventListener("keydown",e=>{(e.code=="Space"||e.code=="Enter")&&O()});const V=(e,t)=>{const r=document.getElementById("actualTest"),n=document.createElement("p");n.classList.add("cheer"),n.innerHTML=t,n.style.color=e?"var(--red)":"var(--green)",n.style.opacity="100%",n.style.top="20%",r.append(n),requestAnimationFrame(()=>{n.style.opacity="0%",n.style.top="0%"}),n.addEventListener("transitionend",function o(){n.removeEventListener("transitionend",o),n.remove()})},O=()=>{C&&clearTimeout(C);const e=s.children[1];let t=Date.now()-i.startTime;const r=c[y],n=i.characters[r.romanji];n?n.mistakes>0?i.characters[r.romanji].time+=t:n.time=t:i.characters[r.romanji]={time:t,mistakes:0},i.mods.includes("ZE")&&(i.characters[r.romanji].encounters?i.characters[r.romanji].encounters++:i.characters[r.romanji].encounters=1),i.startTime=Date.now();const o=e.value.replaceAll(" ","")==r.romanji;if(i.history.push({character:r.romanji,isCorrect:o}),o)je();else if(i.characters[r.romanji].mistakes++,ye(),i.mods.includes("KT")){e.value="";return}let l=0;for(const a of i.history)l+=a.isCorrect?1:0;if(E.innerHTML=`${i.currentCombo}x`,ee.includes(i.currentCombo)&&E.classList.add(`combo${i.currentCombo}`),Y.innerHTML=`${(l/i.history.length*100).toFixed(2)}%`,y+1>=c.length&&R(i).startsWith("Ascended")||window.forceX){he(i);return}s.style.border=`1px solid var(--${o?"green":"red"})`,s.style.marginLeft="-110%",s.addEventListener("transitionend",function a(){if(s.removeEventListener("transitionend",a),y+1>=c.length)if(i.mods.includes("ZE"))y=0,X(c);else{z();return}s.children[0].innerHTML=c[++y].letter,e.value="",e.focus(),s.classList.add("no-transition"),s.style.marginLeft="110%",s.style.border="none",s.offsetWidth,s.classList.remove("no-transition"),s.style.marginLeft="0%",i.timeTrials&&(C=setTimeout(O,i.timeTrials*1e3))})},ye=()=>{if(i.mods.includes("PF")&&(i.failed=!0,z()),V(!0,J(U.negative)),i.currentCombo=0,E.classList="",i.mods.includes("KT"))return;const e=c[y];c.push(e)},je=()=>{V(!1,J(U.positive)),i.currentCombo++,i.longestCombo<i.currentCombo&&(i.longestCombo=i.currentCombo)},z=()=>{const e=document.getElementById("resultsRank"),t=(n,o)=>{const l=n=="character"?0:1,a=document.createElement("p");a.innerHTML=o,N.children[l].append(a)};if(g("results"),R(i,e),i.failed){t("note","You failed");return}let r={character:"none",mistakes:0};for(const n of Object.keys(i.characters)){const o=i.characters[n];i.mods.includes("ZE")?(o.encounters||(o.encounters=1),t("character",`${I("letter",n)}: ${(o.time/1e3/o.encounters).toFixed(2)}s avg (${o.encounters}x)`)):t("character",`${I("letter",n)}: ${(o.time/1e3).toFixed(2)}s${o.mistakes>0?` (${o.mistakes+1}  tries)`:""} `),o.mistakes>r.mistakes&&(r={character:n,mistakes:o.mistakes})}t("note",`Max combo: ${i.longestCombo} ${r.mistakes==0?"(Full combo)":""}`),t("note",`Accuracy: ${Y.innerHTML}`),r.mistakes>0&&t("note",`Hardest character: ${I("letter",r.character)} (${r.mistakes+1} tries)`)},H=document.getElementById("helpPageContainer"),b=document.getElementById("modsPopup"),pe=()=>{document.getElementById("helpBtn").addEventListener("click",()=>{H.classList.toggle("hidden")}),document.getElementById("startBtn").addEventListener("click",()=>{A()}),document.getElementById("modsBtn").addEventListener("click",()=>{b.classList.toggle("hidden")}),document.getElementById("resultsRetryBtn").addEventListener("click",()=>{A()}),document.getElementById("resultsBackBtn").addEventListener("click",()=>{g("main")})};pe();ie();
