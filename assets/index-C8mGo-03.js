(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const y={hiragana:[{title:"Main",groups:[{title:"a",letters:[{romanji:"a",letter:"あ"},{romanji:"i",letter:"い"},{romanji:"u",letter:"う"},{romanji:"e",letter:"え"},{romanji:"o",letter:"お"}]},{title:"k-",letters:[{romanji:"ka",letter:"か"},{romanji:"ki",letter:"き"},{romanji:"ku",letter:"く"},{romanji:"ke",letter:"け"},{romanji:"ko",letter:"こ"}]},{title:"s-",letters:[{romanji:"sa",letter:"さ"},{romanji:"shi",letter:"し"},{romanji:"su",letter:"す"},{romanji:"se",letter:"せ"},{romanji:"so",letter:"そ"}]},{title:"t-",letters:[{romanji:"ta",letter:"た"},{romanji:"chi",letter:"ち"},{romanji:"tsu",letter:"つ"},{romanji:"te",letter:"て"},{romanji:"to",letter:"と"}]},{title:"n-",letters:[{romanji:"na",letter:"な"},{romanji:"ni",letter:"に"},{romanji:"nu",letter:"ぬ"},{romanji:"ne",letter:"ね"},{romanji:"no",letter:"の"}]},{title:"h-",letters:[{romanji:"ha",letter:"は"},{romanji:"hi",letter:"ひ"},{romanji:"fu",letter:"ふ"},{romanji:"he",letter:"へ"},{romanji:"ho",letter:"ほ"}]},{title:"m-",letters:[{romanji:"ma",letter:"ま"},{romanji:"mi",letter:"み"},{romanji:"mu",letter:"む"},{romanji:"me",letter:"め"},{romanji:"mo",letter:"も"}]},{title:"y-",letters:[{romanji:"ya",letter:"や"},{romanji:"yu",letter:"ゆ"},{romanji:"yo",letter:"よ"}]},{title:"r-",letters:[{romanji:"ra",letter:"ら"},{romanji:"ri",letter:"り"},{romanji:"ru",letter:"る"},{romanji:"re",letter:"れ"},{romanji:"ro",letter:"ろ"}]},{title:"w-",letters:[{romanji:"wa",letter:"わ"},{romanji:"wo",letter:"を"}]},{title:"n",letters:[{romanji:"n",letter:"ん"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{romanji:"ga",letter:"が"},{romanji:"gi",letter:"ぎ"},{romanji:"gu",letter:"ぐ"},{romanji:"ge",letter:"げ"},{romanji:"go",letter:"ご"}]},{title:"z-",letters:[{romanji:"za",letter:"ざ"},{romanji:"ji",letter:"じ"},{romanji:"zu",letter:"ず"},{romanji:"ze",letter:"ぜ"},{romanji:"zo",letter:"ぞ"}]},{title:"d-",letters:[{romanji:"da",letter:"だ"},{romanji:"di",letter:"ぢ"},{romanji:"du",letter:"づ"},{romanji:"de",letter:"で"},{romanji:"do",letter:"ど"}]},{title:"b-",letters:[{romanji:"ba",letter:"ば"},{romanji:"bi",letter:"び"},{romanji:"bu",letter:"ぶ"},{romanji:"be",letter:"べ"},{romanji:"bo",letter:"ぼ"}]},{title:"p-",letters:[{romanji:"pa",letter:"ぱ"},{romanji:"pi",letter:"ぴ"},{romanji:"pu",letter:"ぷ"},{romanji:"pe",letter:"ぺ"},{romanji:"po",letter:"ぽ"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{romanji:"kya",letter:"きゃ"},{romanji:"kyu",letter:"きゅ"},{romanji:"kyo",letter:"きょ"}]},{title:"sh-",letters:[{romanji:"sha",letter:"しゃ"},{romanji:"shu",letter:"しゅ"},{romanji:"sho",letter:"しょ"}]},{title:"ch-",letters:[{romanji:"cha",letter:"ちゃ"},{romanji:"chu",letter:"ちゅ"},{romanji:"cho",letter:"ちょ"}]},{title:"ny-",letters:[{romanji:"nya",letter:"にゃ"},{romanji:"nyu",letter:"にゅ"},{romanji:"nyo",letter:"にょ"}]},{title:"hy-",letters:[{romanji:"hya",letter:"ひゃ"},{romanji:"hyu",letter:"ひゅ"},{romanji:"hyo",letter:"ひょ"}]},{title:"my-",letters:[{romanji:"mya",letter:"みゃ"},{romanji:"myu",letter:"みゅ"},{romanji:"myo",letter:"みょ"}]},{title:"ry-",letters:[{romanji:"rya",letter:"りゃ"},{romanji:"ryu",letter:"りゅ"},{romanji:"ryo",letter:"りょ"}]},{title:"gy-",letters:[{romanji:"gya",letter:"ぎょ"},{romanji:"gyu",letter:"ぎゅ"},{romanji:"gyo",letter:"ぎょ"}]},{title:"jy-",letters:[{romanji:"jya",letter:"じゃ"},{romanji:"jyu",letter:"じゅ"},{romanji:"jyo",letter:"じょ"}]},{title:"by-",letters:[{romanji:"bya",letter:"びゃ"},{romanji:"byu",letter:"びゅ"},{romanji:"byo",letter:"びょ"}]},{title:"py-",letters:[{romanji:"pya",letter:"ぴゃ"},{romanji:"pyu",letter:"ぴゅ"},{romanji:"pyo",letter:"ぴょ"}]}]}],katakana:[{title:"Main",groups:[{title:"a",letters:[{letter:"ア",romanji:"a"},{letter:"イ",romanji:"i"},{letter:"ウ",romanji:"u"},{letter:"エ",romanji:"e"},{letter:"オ",romanji:"o"}]},{title:"k-",letters:[{letter:"カ",romanji:"ka"},{letter:"キ",romanji:"ki"},{letter:"ク",romanji:"ku"},{letter:"ケ",romanji:"ke"},{letter:"コ",romanji:"ko"}]},{title:"s-",letters:[{letter:"サ",romanji:"sa"},{letter:"シ",romanji:"shi"},{letter:"ス",romanji:"su"},{letter:"セ",romanji:"se"},{letter:"ソ",romanji:"so"}]},{title:"t-",letters:[{letter:"タ",romanji:"ta"},{letter:"チ",romanji:"chi"},{letter:"ツ",romanji:"tsu"},{letter:"テ",romanji:"te"},{letter:"ト",romanji:"to"}]},{title:"n-",letters:[{letter:"ナ",romanji:"na"},{letter:"ニ",romanji:"ni"},{letter:"ヌ",romanji:"nu"},{letter:"ネ",romanji:"ne"},{letter:"ノ",romanji:"no"}]},{title:"h-",letters:[{letter:"ハ",romanji:"ha"},{letter:"ヒ",romanji:"hi"},{letter:"フ",romanji:"fu"},{letter:"ヘ",romanji:"he"},{letter:"ホ",romanji:"ho"}]},{title:"m-",letters:[{letter:"マ",romanji:"ma"},{letter:"ミ",romanji:"mi"},{letter:"ム",romanji:"mu"},{letter:"メ",romanji:"me"},{letter:"モ",romanji:"mo"}]},{title:"y-",letters:[{letter:"ヤ",romanji:"ya"},{letter:"ユ",romanji:"yu"},{letter:"ヨ",romanji:"yo"}]},{title:"r-",letters:[{letter:"ラ",romanji:"ra"},{letter:"リ",romanji:"ri"},{letter:"ル",romanji:"ru"},{letter:"レ",romanji:"re"},{letter:"ロ",romanji:"ro"}]},{title:"w-",letters:[{letter:"ワ",romanji:"wa"},{letter:"ヲ",romanji:"wo"}]},{title:"n",letters:[{letter:"ン",romanji:"n"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{letter:"ガ",romanji:"ga"},{letter:"ギ",romanji:"gi"},{letter:"グ",romanji:"gu"},{letter:"ゲ",romanji:"ge"},{letter:"ゴ",romanji:"go"}]},{title:"z-",letters:[{letter:"ザ",romanji:"za"},{letter:"ジ",romanji:"zi"},{letter:"ズ",romanji:"zu"},{letter:"ゼ",romanji:"ze"},{letter:"ゾ",romanji:"zo"}]},{title:"d-",letters:[{letter:"ダ",romanji:"da"},{letter:"ヂ",romanji:"di"},{letter:"ヅ",romanji:"du"},{letter:"デ",romanji:"de"},{letter:"ド",romanji:"do"}]},{title:"b-",letters:[{letter:"バ",romanji:"ba"},{letter:"ビ",romanji:"bi"},{letter:"ブ",romanji:"bu"},{letter:"ベ",romanji:"be"},{letter:"ボ",romanji:"bo"}]},{title:"p-",letters:[{letter:"パ",romanji:"pa"},{letter:"ピ",romanji:"pi"},{letter:"プ",romanji:"pu"},{letter:"ペ",romanji:"pe"},{letter:"ポ",romanji:"po"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{letter:"キャ",romanji:"kya"},{letter:"キュ",romanji:"kyu"},{letter:"キョ",romanji:"kyo"}]},{title:"sh-",letters:[{letter:"シャ",romanji:"sha"},{letter:"シュ",romanji:"shu"},{letter:"ショ",romanji:"sho"}]},{title:"ch-",letters:[{letter:"チャ",romanji:"cha"},{letter:"チュ",romanji:"chu"},{letter:"チョ",romanji:"cho"}]},{title:"ny-",letters:[{letter:"ニャ",romanji:"nya"},{letter:"ニュ",romanji:"nyu"},{letter:"ニョ",romanji:"nyo"}]},{title:"hy-",letters:[{letter:"ヒャ",romanji:"hya"},{letter:"ヒュ",romanji:"hyu"},{letter:"ヒョ",romanji:"hyo"}]},{title:"my-",letters:[{letter:"ミャ",romanji:"mya"},{letter:"ミュ",romanji:"myu"},{letter:"ミョ",romanji:"myo"}]},{title:"ry-",letters:[{letter:"リャ",romanji:"rya"},{letter:"リュ",romanji:"ryu"},{letter:"リョ",romanji:"ryo"}]},{title:"gy-",letters:[{letter:"ギャ",romanji:"gya"},{letter:"ギュ",romanji:"gyu"},{letter:"ギョ",romanji:"gyo"}]},{title:"jy-",letters:[{letter:"jヤ",romanji:"jya"},{letter:"jユ",romanji:"jyu"},{letter:"jヨ",romanji:"jyo"}]},{title:"by-",letters:[{letter:"ビャ",romanji:"bya"},{letter:"ビュ",romanji:"byu"},{letter:"ビョ",romanji:"byo"}]},{title:"py-",letters:[{letter:"ピャ",romanji:"pya"},{letter:"ピュ",romanji:"pyu"},{letter:"ピョ ",romanji:"pyo"}]}]}]},ue={negative:["Nope!","Try again!","Not like this!"],positive:["Good job!","Correct!","Nice!"]};let L=0,g=Object.keys(y)[L];const je=e=>{L=e,g=Object.keys(y)[L]},te=[{short:"TT",title:"Time Trials",description:"Limit how much time you have to name a character. 0 to disable"},{short:"KT",title:"Keep Trying",description:"Retry each character until you name it correctly"},{short:"PF",title:"Perfect",description:"Restart if you make a single mistake"},{short:"R",title:"Random",description:"Shuffle characters"},{short:"ZE",title:"Zen",description:"Just type the charactes, forever. Always random"}],be=[10,25,50,75,100],Ee=[["a","ka","sa","ta","na","ha","ma","ya","ra","wa","n"],["i","ki","shi","chi","ni","hi","mi","","ri","",""],["u","ku","su","tsu","nu","fu","mu","yu","ru","",""],["e","ke","se","te","ne","he","me","","re","",""],["o","ko","so","to","no","ho","mo","yo","ro","wo",""]],K=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let E=0;const Te=["Tab","Escape","Enter"],k={},P={};let A=!1;const W=()=>{const e=document.getElementById("devTools"),t=document.getElementById("popupContainer");let n=!t.classList.contains("hidden")||!e.classList.contains("hidden");return t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.contains("hidden")||e.classList.add("hidden"),n},ke=()=>{document.addEventListener("keydown",e=>{for(const t of Object.keys(k[g]))X==u.MAIN&&(e.key==t&&k[g][t](),t.startsWith("S")&&e.shiftKey&&e.key.toLowerCase()==t.charAt(1)&&k[g][t]());switch(Te.includes(e.code)&&e.preventDefault(),X){case u.MAIN:switch(e.code){case"Enter":W(),F();break;case"Escape":W();break;case"Space":De();break;case"F1":f(u.STATS);break;case"F2":R(N);break;case"CapsLock":A&&fe(),A=!A,document.getElementById("alphabetBtn").innerHTML=`${Y()}<br>${A?"[Again]":"[Caps Lock]"}`;break}if(!N.classList.contains("hidden")&&e.code.startsWith("Digit")&&document.getElementById("TTSeconds")!=document.activeElement){const t=Number(e.code.slice(-1)),n=r=>{r.checked=!r.checked};if(t>4)return;if(n(document.getElementsByClassName(`Mod${t}`)[0]),t==4)for(let r=0;r<=3;r++)n(document.getElementsByClassName(`Mod${r}`)[0])}if(e.shiftKey&&e.code.startsWith("Digit")&&P[g][Number(e.code.slice(-1))](),!N.classList.contains("hidden")&&e.key=="`"){const t=document.getElementById("TTSeconds");t.focus(),t.value=t.value.replaceAll("`","")}break;case u.TEST:e.code=="Escape"&&(s.mods.includes("ZE")?_(s):f(u.MAIN));break;case u.RESULTS:switch(e.code){case"Tab":F();break;case"Escape":f(u.MAIN);break}break;case u.STATS:switch(e.code){case"F1":case"Escape":if(W())return;f(u.MAIN);break}break}E>0&&e.key!=K[E]&&(E=0),e.key==K[E]&&E++,E>=K.length&&(document.getElementById("devTools").classList.toggle("hidden"),E=0)})},j=new Set;let b="";function Le(e){const t=()=>{n.classList.toggle("selected")?j.add(e.title):(j.delete(e.title),n.parentElement.classList.remove("selected"))},n=document.createElement("div");n.classList.add("alphabetSubGroup");const r=document.createElement("p");return r.textContent=`${e.title} (${e.letters[0].letter})`,n.appendChild(r),n.addEventListener("click",()=>{t()}),e.title.length<3?k[b][e.title.charAt(0)]=t:k[b]["S"+e.title.charAt(0)]=t,n}function xe(e,t){const n=()=>{const i=r.classList.toggle("selected");for(const a of r.children)a.classList.contains("alphabetSubGroup")&&(i?(a.classList.add("selected"),j.add(a.children[0].innerHTML.split(" ")[0])):(a.classList.remove("selected"),j.delete(a.children[0].innerHTML.split(" ")[0])))},r=document.createElement("div");r.classList.add("alphabetGroup");const o=document.createElement("p");o.textContent=`${e.title} [Shift + ${t+1}]`,r.appendChild(o);for(const i of e.groups){const a=Le(i);r.appendChild(a)}return o.addEventListener("click",()=>{n()}),P[b][t+1]=n,r}function ve(e,t){const n=document.createElement("div");n.classList.add("alphabet"),n.id=`${e}Alphabet`,b=e,g!=e&&n.classList.add("hidden");const r=document.createElement("p");r.textContent=e,n.appendChild(r),k[b]||(k[b]={}),P[b]||(P[b]=[]);for(const o in t){const i=xe(t[o],Number(o));n.appendChild(i)}return n}const Ie=document.getElementById("content"),we=document.getElementById("disclaimer");for(const e of Object.keys(y)){const t=ve(e,y[e]);Ie.insertBefore(t,we)}window.onload=()=>{document.getElementById("alphabetBtn").innerHTML=`${Y()}<br>[Caps Lock]`};const Se=document.getElementById("modsScreen");for(const e in te){const t=te[e];if(t.short=="TT")continue;const n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("p");o.innerHTML=t.title,r.append(o);const i=document.createElement("p");i.innerHTML=`[${Number(e)}]
${t.description}`,r.append(i),n.append(r);const a=document.createElement("input");a.type="checkbox",a.id=`${t.short}Selected`,a.classList.add(`Mod${Number(e)}`),n.append(a),Se.append(n)}const C=e=>{let t=0;for(const n of e.history)t+=n.isCorrect?1:0;return t/e.history.length*100},Be=[{text:"F",longText:"Fail",condition:e=>e.failed},{text:"",longText:"",condition:e=>{if(window.forceX)return!0;if(j.size<25)return!1;for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"SS",longText:"Perfect",condition:e=>{for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"S",longText:"Almost there",condition:e=>C(e)>95},{text:"A",longText:"Good job",condition:e=>C(e)>90},{text:"B",longText:"Keep going",condition:e=>C(e)>80},{text:"C",longText:"I'm done with long text for now",condition:e=>C(e)>70},{text:"D",longText:"I'm done with long text for now",condition:()=>!0}],Me=[{text:"☆",condition:e=>!!e.mods?.includes("PF")},{text:"+",condition:e=>!!e.mods?.includes("KT")},{text:"꩜",condition:e=>!!e.mods?.includes("R")}],Ae=[{text:"Ascended",style:"font-size: 2.5rem;font-weight: 900;letter-spacing: 2px;text-transform: uppercase;background: linear-gradient(270deg, #00ffe0, #ff00c8, #ffd700, #00ffe0);background-size: 800% 800%;-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: pulseGradient 6s ease infinite, glowPulse 2s ease-in-out infinite;text-shadow:0 0 10px rgba(255,255,255,0.9),0 0 20px rgba(0,255,255,0.6),0 0 30px rgba(255,0,255,0.6);border: 2px solid rgba(255,255,255,0.2);border-radius: 12px;padding: 0.5rem 1rem;box-shadow:0 0 15px rgba(255,255,255,0.1),0 0 25px rgba(0,255,255,0.3);display: inline-block;",condition:e=>!!(window.forceX||j.size>=25&&e.timeTrials&&e.timeTrials<=1&&e.mods.includes("PF")&&e.mods.includes("R")&&e.mods.includes("KT"))},{text:"Divine",style:"font-weight: 800;background: linear-gradient(90deg, #ff6ec4, #7873f5, #4ac29a);-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: shine 3s infinite linear;text-shadow: 0 0 8px rgba(255,255,255,0.6);",condition:e=>!!(e.timeTrials&&e.timeTrials<=2&&e.mods.includes("PF"))},{text:"Mythical",style:"color: crimson; font-weight: bold; text-shadow: 0 0 8px red;",condition:e=>!!(e.timeTrials&&e.timeTrials<=2.5&&e.mods.includes("PF"))},{text:"Godspeed",style:"color: #ff4081; font-style: italic; text-shadow: 0 0 5px #ff4081;",condition:e=>!!(e.timeTrials&&e.timeTrials<=3&&e.mods.includes("PF"))},{text:"Elite",style:"color: gold; font-weight: bold; text-shadow: 1px 1px 4px #b8860b;",condition:e=>!!(e.timeTrials&&e.timeTrials<=4&&e.mods.includes("PF"))},{text:"Sharp",style:"color: #4caf50; font-weight: 600; text-shadow: 0 0 5px #4caf50;",condition:e=>!!(e.timeTrials&&e.timeTrials<=5&&e.mods.includes("PF"))},{text:"Swift",style:"color: #00bcd4; font-style: italic;",condition:e=>!!(e.timeTrials&&e.timeTrials<=7&&e.mods.includes("PF"))},{text:"Quick",style:"color: #5bc0de; font-weight: bold;",condition:e=>!!(e.timeTrials&&e.timeTrials<=9&&e.mods.includes("PF"))},{text:"Casual",style:"color: gray;",condition:e=>!!(e.timeTrials&&e.timeTrials<=10&&e.mods.includes("PF"))}],Ce=(e,t)=>t.data.find(n=>n.character===e),U=(e,t)=>{let n=[];switch(e){case"run":n=n.concat(...t.performance.map(i=>i.weight));break;case"heatmapValue":n=n.concat(...t.data.map(i=>i.value));break;case"heatmapAmount":n=n.concat(...t.data.map(i=>i.amount));break}let r=Math.min(...n);return e=="heatmapAmount"&&(r=r*.75),{max:Math.max(...n),min:r}},ne=(e,t)=>{const n={alphabet:t,data:[]};e.forEach(i=>{if(i.longestCombo==0){Oe(i.timestamp);return}i.alphabet==t&&i.performance.forEach(a=>{const m=n.data.find(l=>l.character===x("romanji",a.character,i.alphabet));m?(m.amount++,m.value+=a.weight):n.data.push({amount:1,value:a.weight,character:x("romanji",a.character,i.alphabet)})})});const r=U("heatmapValue",n),o=U("heatmapAmount",n);return n.data.forEach(i=>{i.value=D(i.value,r.max,r.min),i.amount=D(i.amount,o.max,o.min)}),n},re=(e,t)=>{const n=document.createElement("div"),r=e.alphabet;n.prepend(document.createElement("div")),Ee.forEach((o,i)=>{i==0&&o.forEach(a=>{const m=document.createElement("div");m.classList.add("heatmapHeader"),m.innerHTML=a.charAt(0),n.append(m)}),o.forEach((a,m)=>{if(m==0){const c=document.createElement("div");c.classList.add("heatmapHeader"),c.innerHTML=o[0].charAt(0),n.append(c)}const l=document.createElement("div");let h="transparent";if(l.innerHTML="",a!=""){const c=Ce(a,e);h=c?G(c.value):"var(--surface-2)",l.style.transform=`scale(${c?1+Math.log10(c.amount):1})`,l.innerHTML=x("letter",a,r),c?.value==1&&(l.style.boxShadow="0 0 10px var(--red)"),c?.value==0&&(l.style.boxShadow="0 0 10px var(--green)"),c&&(l.title=`value:${1-c.value}, encounter rate:${c.amount}`)}l.style.backgroundColor=h,n.append(l)})}),document.getElementById(t).appendChild(n)},$e=e=>{const t=document.createElement("div");t.classList.add("run");const n=document.createElement("p");n.classList.add("runTimestamp"),n.innerHTML=new Date(e.timestamp).toLocaleString("en-GB"),t.append(n);const r=document.createElement("p");r.classList.add("runAlphabet"),r.innerHTML=y[e.alphabet][0].groups[0].letters[0].letter,t.append(r);const o=document.createElement("div");o.classList.add("runDetails");const i=U("run",e);e.performance.forEach(c=>{const z=D(c.weight,i.max,i.min),v=document.createElement("p");v.style.color=G(z),v.innerHTML=c.character,v.title=`~${c.time}s`,c.mistakes>0&&(v.title=`X${c.mistakes} `+v.title),o.append(v)}),t.append(o);const a=document.createElement("p");a.classList.add("runRank");const m=O(e,!0);a.innerHTML=m.string,a.style=m.style,t.append(a);const l=document.createElement("p");l.classList.add("runStats");let h=0;e.history.forEach(c=>{h+=c.isCorrect?1:0}),h=h/e.history.length*100,l.innerHTML=`${h.toFixed(2)}% ${e.longestCombo}x`,t.append(l),document.getElementById("statsRuns").prepend(t)},He=e=>{const t=document.getElementById("graph");debugger;t.width=t.parentElement.parentElement.clientWidth,t.height=t.width;const n=t.getContext("2d");e.forEach(r=>{r.data.forEach(o=>{o.value=1-o.value;const i=t.height*.05+o.amount*t.width*.9,a=t.height*.05+(1-o.value)*t.height*.9;n.fillStyle=G((1-o.value+1-o.amount)*.5),n.fillText(x("letter",o.character,r.alphabet),i,a)})})},Ne=()=>{document.getElementById("statsHeatmap").innerHTML="",document.getElementById("statsRuns").innerHTML=""},Pe=()=>{localStorage.getItem("statsInfoSeen")||(R(document.getElementById("statsNotice")),localStorage.setItem("statsInfoSeen","true")),Ne();const e=ye(),t=ne(e,"hiragana"),n=ne(e,"katakana");re(t,"statsHeatmap"),re(n,"statsHeatmap"),e.forEach(r=>$e(r)),Re(),He([t,n])},Re=()=>{if(localStorage.getItem("profile")){const e=Ge(),t=document.getElementById("statsPfp");t.src=e.pfp;const n=document.getElementById("statsNickname");n.value=e.nickname;const r=document.getElementById("statsSlogan");r.value=e.slogan}},he=e=>{let t=e.length;for(;t!=0;){let n=Math.floor(Math.random()*t);t--,[e[t],e[n]]=[e[n],e[t]]}},pe=e=>e[Math.floor(Math.random()*e.length)];var u=(e=>(e[e.MAIN=0]="MAIN",e[e.TEST=1]="TEST",e[e.RESULTS=2]="RESULTS",e[e.STATS=3]="STATS",e))(u||{});let X=0;const oe=[document.getElementById("content"),document.getElementById("actualTest"),document.getElementById("resultsScreen"),document.getElementById("statsScreen")],f=e=>{oe.forEach(t=>{t?.classList.add("hidden")}),X=e,oe[e]?.classList.remove("hidden"),e==3&&Pe()},x=(e,t,n)=>{n||(n=g);for(const r of y[n])for(const o of r.groups)for(const i of o.letters){if(e=="letter"&&i.romanji==t)return i.letter;if(e=="romanji"&&i.letter==t)return i.romanji}return"?"},O=(e,t)=>{let n="",r="";for(const o of Be)if(o.condition(e)){n=o.text;break}if(t)return{style:r,string:n};for(const o of Ae){if(e.failed)break;if(o.condition(e)){n=`${o.text} ${n}`,r=o.style;break}}for(const o of Me){if(e.failed)break;if(n.startsWith("Ascended")){n.trimEnd();break}if(o.condition(e)){n=n+o.text;break}}return{style:r,string:n}},De=()=>{document.querySelector(".alphabetSubGroup")?.classList.contains("selected")?V("off"):V("on")},Y=()=>{const e=Object.keys(y),t=L+1>=e.length?0:L+1,n=y[g][0].groups[0].letters[0].letter,r=y[e[t]][0].groups[0].letters[0].letter;return`${n} -> ${r}`},V=e=>{document.querySelectorAll(".alphabetSubGroup").forEach(t=>{const n=t.children[0].innerHTML.split(" ")[0];e=="off"?(t.classList.remove("selected"),j.clear()):(t.classList.add("selected"),j.add(n))})},fe=()=>{const e=Object.keys(y),t=L+1>e.length-1?0:L+1;je(t),document.querySelectorAll(".alphabet").forEach(n=>{n.classList.add("hidden")}),document.getElementById(`${e[t]}Alphabet`).classList.remove("hidden"),j.clear(),V("off")},ye=()=>JSON.parse(localStorage.getItem("history")||"[]"),Fe=(e,t,n)=>{const r=JSON.parse(localStorage.getItem("history")||"[]");r.push({...e,performance:t,alphabet:n}),localStorage.setItem("history",JSON.stringify(r))},Oe=e=>{const t=ye(),n=[];t.forEach(r=>{r.timestamp!=e&&n.push(r)}),localStorage.setItem("history",JSON.stringify(n))},R=e=>{const t=document.getElementById("popupContainer");t.innerHTML="",t.appendChild(e),t.children[0].classList.remove("hidden"),t.classList.remove("hidden")},Ge=()=>(localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"})),JSON.parse(localStorage.getItem("profile"))),Z=(e,t)=>{localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"}));const n=JSON.parse(localStorage.getItem("profile"));n[e]=t,localStorage.setItem("profile",JSON.stringify(n))};let I=[];const Q=document.getElementById("resultsNotes"),ze=document.getElementById("accuracyText"),ae=document.getElementById("resultsRank"),w=e=>{const{type:t,text:n,color:r,isPerfect:o}=e,i=t=="character"?0:1,a=document.createElement("p");a.innerHTML=n,r&&(a.style.color=r),o&&r&&(a.style.textShadow=`${r} 0 0 8px`),Q.children[i].append(a)},D=(e,t,n)=>t===n?0:(e-n)/(t-n),G=e=>{const m=Math.round(166+77*e),l=Math.round(227+-88*e),h=Math.round(161+7*e);return`rgb(${m},${l},${h})`},_=e=>{if(e.mods.includes("ZE")&&e.longestCombo<1){f(u.MAIN);return}Q.children[0].innerHTML="",Q.children[1].innerHTML="",I=[],f(u.RESULTS),e.timestamp=Date.now();const t=O(e);if(ae.style=t.style,ae.innerHTML=t.string,e.failed){w({type:"note",text:"You failed"});return}let n={character:"none",mistakes:0};for(const a of Object.keys(e.characters)){const m=x("letter",a),l=e.characters[a];l.encounters||(l.encounters=1);const h=Math.max(l.time/1e3/(e.mods.includes("ZE")?l.encounters:1),.02),c=l.mistakes,z=Math.pow(h,1+Math.pow(c,1.5));I.push({key:a,character:m,mistakes:c,time:h,weight:z,encounters:l.encounters}),l.mistakes>n.mistakes&&(n={character:m,mistakes:l.mistakes})}Fe(e,I,g);const r=I.map(a=>a.weight),o=Math.min(...r),i=Math.max(5,...r);I.sort((a,m)=>a.weight-m.weight);for(const a of I){const m=D(a.weight,i,o),l=G(m),h=((a.encounters-a.mistakes)/a.encounters*100).toFixed(2),c=a.mistakes>0?`(${a.encounters-a.mistakes}/${a.encounters})`:"";e.mods.includes("ZE")?w({type:"character",text:`${a.character}:  ~${a.time.toFixed(2)}s ${h}% ${c}`,color:l,isPerfect:a.mistakes<=0}):w({type:"character",text:`${a.character}: ${a.time.toFixed(2)}s ${a.mistakes>0?`(${a.mistakes}✗)`:""}`,color:l,isPerfect:a.mistakes<=0})}w({type:"note",text:`Max combo: ${e.longestCombo} ${n.mistakes==0?"(Full combo)":""}`}),w({type:"note",text:`Accuracy: ${ze.innerHTML}`}),n.mistakes>0&&w({type:"note",text:`Hardest character: ${x("letter",n.character)} (${n.mistakes+1} tries)`})},ie=document.getElementById("comboText"),se=document.getElementById("accuracyText"),le=document.getElementById("modsDisplay"),B=document.getElementById("actualTest").children[0],S=document.getElementById("resultsRank"),$=document.getElementById("resultsButtons"),Ke=document.getElementById("resultsNotes");let J=1e3;const q=e=>new Promise(t=>setTimeout(t,e)),We=e=>{const t=document.createElement("p");t.innerHTML=e,t.style.opacity="0",t.classList.add("yes-transition"),t.classList.add("transcendedCharacter"),Ke.children[0].append(t),requestAnimationFrame(()=>{t.style.opacity="1"})},Ze=async e=>{ie.style.display="none",se.style.display="none",le.style.display="none",$.style.opacity="0%",$.classList.add("yes-transition"),S.style.opacity="0%",S.classList.add("yes-transition"),B.style.transition="all 2s ease-in-out",B.classList.add("transcendedCard"),B.style.opacity="0%",await q(2e3),f(u.RESULTS);for(const r of Object.keys(e.characters))We(`${x("letter",r)}: Perfect`),await q(J),J=Math.max(200,J*.9);const t=O(e);S.style=t.style,S.innerHTML=t.string,S.style.opacity="100%",await q(1e3);const n=()=>{B.removeAttribute("style"),B.classList.remove("transcendedCard"),S.removeAttribute("style"),ie.removeAttribute("style"),se.removeAttribute("style"),le.removeAttribute("style")};$.style.opacity="100%",$.addEventListener("click",n)};let p=[],T=0,s={timestamp:0,history:[],startTime:0,currentCombo:0,longestCombo:0,characters:{},mods:[]};const M=document.getElementById("comboText"),ce=document.getElementById("accuracyText"),me=document.getElementById("resultsNotes"),de=document.getElementById("modsDisplay"),d=document.getElementById("current");let H;const F=()=>{p=[],T=0;for(const r of y[g])for(const o of r.groups)if(j.has(o.title))for(const i of o.letters)p.push(i);if(p.length==0){f(u.MAIN);return}me.children[0].innerHTML="",me.children[1].innerHTML="",s={timestamp:0,history:[],startTime:Date.now(),currentCombo:0,longestCombo:0,characters:{},mods:[]},["KT","PF","R","ZE"].forEach(r=>{document.getElementById(r+"Selected").checked&&s.mods?.push(r)});const e=Number(document.getElementById("TTSeconds").value);e>0&&(s.mods?.push("TT:"+e),s.timeTrials=e),(s.mods.includes("R")||s.mods.includes("ZE"))&&he(p);const t=document.getElementById("actualTest").children[0],n=t.children[1];t.children[0].innerHTML=p[0].letter,n.value="",M.innerHTML="0x",M.classList="",de.innerHTML="",d.style.border="none",n.value="",s.mods?.forEach(r=>{const o=document.createElement("p");o.innerHTML=r,de?.append(o)}),t.classList.add("no-transition"),t.style.marginLeft="0%",t.offsetWidth,t.classList.remove("no-transition"),f(u.TEST),n.focus(),s.timeTrials&&(H=setTimeout(ee,s.timeTrials*1e3))};document.getElementById("romanjiInput").addEventListener("keydown",e=>{(e.code=="Space"||e.code=="Enter")&&ee()});const ge=(e,t)=>{const n=document.getElementById("actualTest"),r=document.createElement("p");r.classList.add("cheer"),r.innerHTML=t,r.style.color=e?"var(--red)":"var(--green)",r.style.opacity="100%",r.style.top="20%",n.append(r),requestAnimationFrame(()=>{r.style.opacity="0%",r.style.top="0%"}),r.addEventListener("transitionend",function o(){r.removeEventListener("transitionend",o),r.remove()})},ee=()=>{H&&clearTimeout(H);const e=d.children[1];let t=Date.now()-s.startTime;const n=p[T],r=s.characters[n.romanji];if(e.value=e.value.replaceAll(" ",""),e.value==""){Ue();return}r?s.characters[n.romanji].time+=t:s.characters[n.romanji]={time:t,mistakes:0},s.mods.includes("ZE")&&(s.characters[n.romanji].encounters?s.characters[n.romanji].encounters++:s.characters[n.romanji].encounters=1),s.startTime=Date.now();const o=e.value.replaceAll(" ","")==n.romanji;if(s.history.push({character:n.romanji,isCorrect:o}),o)qe();else if(s.characters[n.romanji].mistakes++,Je(),s.mods.includes("KT")){e.value="";return}let i=0;for(const a of s.history)i+=a.isCorrect?1:0;if(M.innerHTML=`${s.currentCombo}x`,be.includes(s.currentCombo)&&M.classList.add(`combo${s.currentCombo}`),ce.innerHTML=`${(i/s.history.length*100).toFixed(2)}%`,s.mods.includes("ZE")){let a=0;s.history.forEach(m=>{m.isCorrect||a++}),ce.innerHTML+=` (${s.history.length-a}/${s.history.length})`}if(T+1>=p.length&&O(s).string.startsWith("Ascended")||window.forceX){Ze(s);return}d.style.border=`1px solid var(--${o?"green":"red"})`,d.style.marginLeft="-110%",d.addEventListener("transitionend",function a(){if(d.removeEventListener("transitionend",a),T+1>=p.length)if(s.mods.includes("ZE"))T=0,he(p);else{_(s);return}d.children[0].innerHTML=p[++T].letter,e.value="",e.focus(),d.classList.add("no-transition"),d.style.marginLeft="110%",d.style.border="none",d.offsetWidth,d.classList.remove("no-transition"),d.style.marginLeft="0%",s.timeTrials&&(H=setTimeout(ee,s.timeTrials*1e3))})},Je=()=>{if(s.mods.includes("PF")&&(s.failed=!0,_(s)),ge(!0,pe(ue.negative)),s.currentCombo=0,M.classList="",s.mods.includes("KT"))return;const e=p[T];p.push(e)},qe=()=>{ge(!1,pe(ue.positive)),s.currentCombo++,s.longestCombo<s.currentCombo&&(s.longestCombo=s.currentCombo)},Ue=()=>{d.classList.add("maybe-transition"),d.style.marginLeft="-5%",d.addEventListener("transitionend",function e(){d.removeEventListener("transitionend",e),d.style.marginLeft="5%",d.addEventListener("transitionend",function t(){d.removeEventListener("transitionend",t),d.style.marginLeft="0%",d.classList.remove("maybe-transition")})})},Xe=document.getElementById("helpPage"),N=document.getElementById("modsScreen"),Ve=()=>{document.getElementById("startBtn").addEventListener("click",()=>{F()}),document.getElementById("helpBtn").addEventListener("click",()=>{R(Xe)}),document.getElementById("statsBtn").addEventListener("click",()=>{f(u.STATS)}),document.getElementById("modsBtn").addEventListener("click",()=>{R(N)}),document.getElementById("alphabetBtn").addEventListener("click",()=>{fe(),document.getElementById("alphabetBtn").innerHTML=`${Y()}<br>[Caps Lock]`}),document.getElementById("resultsRetryBtn").addEventListener("click",()=>{F()}),document.getElementById("resultsBackBtn").addEventListener("click",()=>{f(u.MAIN)}),document.getElementById("wipeHistory").addEventListener("click",()=>{localStorage.removeItem("history")}),document.getElementById("devForceAscend").addEventListener("click",()=>{window.forceX=!0}),document.getElementById("resetStatsPopup").addEventListener("click",()=>{localStorage.removeItem("statsInfoSeen")}),document.getElementById("wipeProfile").addEventListener("click",()=>{localStorage.removeItem("profile")}),document.getElementById("statsPfp").addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.onchange=t=>{const n=e.files[0],r=new FileReader;r.onload=()=>{const o=r.result;document.getElementById("statsPfp").src=""+o,Z("pfp",""+o)},r.readAsDataURL(n)},e.click()}),document.getElementById("statsNickname").addEventListener("change",()=>{Z("nickname",document.getElementById("statsNickname").value)}),document.getElementById("statsSlogan").addEventListener("change",()=>{Z("slogan",document.getElementById("statsSlogan").value)}),document.querySelectorAll(".statsDataButton").forEach(e=>{e.addEventListener("click",t=>{for(const n of document.getElementById("statsDetailsData").children)n.classList.add("hidden");console.log(t),document.getElementById("statsDetailsData").children[t.target.dataset.id].classList.remove("hidden")})})};Ve();ke();
