(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const h={hiragana:[{title:"Main",groups:[{title:"a",letters:[{romanji:"a",letter:"あ"},{romanji:"i",letter:"い"},{romanji:"u",letter:"う"},{romanji:"e",letter:"え"},{romanji:"o",letter:"お"}]},{title:"k-",letters:[{romanji:"ka",letter:"か"},{romanji:"ki",letter:"き"},{romanji:"ku",letter:"く"},{romanji:"ke",letter:"け"},{romanji:"ko",letter:"こ"}]},{title:"s-",letters:[{romanji:"sa",letter:"さ"},{romanji:"shi",letter:"し"},{romanji:"su",letter:"す"},{romanji:"se",letter:"せ"},{romanji:"so",letter:"そ"}]},{title:"t-",letters:[{romanji:"ta",letter:"た"},{romanji:"chi",letter:"ち"},{romanji:"tsu",letter:"つ"},{romanji:"te",letter:"て"},{romanji:"to",letter:"と"}]},{title:"n-",letters:[{romanji:"na",letter:"な"},{romanji:"ni",letter:"に"},{romanji:"nu",letter:"ぬ"},{romanji:"ne",letter:"ね"},{romanji:"no",letter:"の"}]},{title:"h-",letters:[{romanji:"ha",letter:"は"},{romanji:"hi",letter:"ひ"},{romanji:"fu",letter:"ふ"},{romanji:"he",letter:"へ"},{romanji:"ho",letter:"ほ"}]},{title:"m-",letters:[{romanji:"ma",letter:"ま"},{romanji:"mi",letter:"み"},{romanji:"mu",letter:"む"},{romanji:"me",letter:"め"},{romanji:"mo",letter:"も"}]},{title:"y-",letters:[{romanji:"ya",letter:"や"},{romanji:"yu",letter:"ゆ"},{romanji:"yo",letter:"よ"}]},{title:"r-",letters:[{romanji:"ra",letter:"ら"},{romanji:"ri",letter:"り"},{romanji:"ru",letter:"る"},{romanji:"re",letter:"れ"},{romanji:"ro",letter:"ろ"}]},{title:"w-",letters:[{romanji:"wa",letter:"わ"},{romanji:"wo",letter:"を"}]},{title:"n",letters:[{romanji:"n",letter:"ん"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{romanji:"ga",letter:"が"},{romanji:"gi",letter:"ぎ"},{romanji:"gu",letter:"ぐ"},{romanji:"ge",letter:"げ"},{romanji:"go",letter:"ご"}]},{title:"z-",letters:[{romanji:"za",letter:"ざ"},{romanji:"ji",letter:"じ"},{romanji:"zu",letter:"ず"},{romanji:"ze",letter:"ぜ"},{romanji:"zo",letter:"ぞ"}]},{title:"d-",letters:[{romanji:"da",letter:"だ"},{romanji:"di",letter:"ぢ"},{romanji:"du",letter:"づ"},{romanji:"de",letter:"で"},{romanji:"do",letter:"ど"}]},{title:"b-",letters:[{romanji:"ba",letter:"ば"},{romanji:"bi",letter:"び"},{romanji:"bu",letter:"ぶ"},{romanji:"be",letter:"べ"},{romanji:"bo",letter:"ぼ"}]},{title:"p-",letters:[{romanji:"pa",letter:"ぱ"},{romanji:"pi",letter:"ぴ"},{romanji:"pu",letter:"ぷ"},{romanji:"pe",letter:"ぺ"},{romanji:"po",letter:"ぽ"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{romanji:"kya",letter:"きゃ"},{romanji:"kyu",letter:"きゅ"},{romanji:"kyo",letter:"きょ"}]},{title:"sh-",letters:[{romanji:"sha",letter:"しゃ"},{romanji:"shu",letter:"しゅ"},{romanji:"sho",letter:"しょ"}]},{title:"ch-",letters:[{romanji:"cha",letter:"ちゃ"},{romanji:"chu",letter:"ちゅ"},{romanji:"cho",letter:"ちょ"}]},{title:"ny-",letters:[{romanji:"nya",letter:"にゃ"},{romanji:"nyu",letter:"にゅ"},{romanji:"nyo",letter:"にょ"}]},{title:"hy-",letters:[{romanji:"hya",letter:"ひゃ"},{romanji:"hyu",letter:"ひゅ"},{romanji:"hyo",letter:"ひょ"}]},{title:"my-",letters:[{romanji:"mya",letter:"みゃ"},{romanji:"myu",letter:"みゅ"},{romanji:"myo",letter:"みょ"}]},{title:"ry-",letters:[{romanji:"rya",letter:"りゃ"},{romanji:"ryu",letter:"りゅ"},{romanji:"ryo",letter:"りょ"}]},{title:"gy-",letters:[{romanji:"gya",letter:"ぎょ"},{romanji:"gyu",letter:"ぎゅ"},{romanji:"gyo",letter:"ぎょ"}]},{title:"jy-",letters:[{romanji:"jya",letter:"じゃ"},{romanji:"jyu",letter:"じゅ"},{romanji:"jyo",letter:"じょ"}]},{title:"by-",letters:[{romanji:"bya",letter:"びゃ"},{romanji:"byu",letter:"びゅ"},{romanji:"byo",letter:"びょ"}]},{title:"py-",letters:[{romanji:"pya",letter:"ぴゃ"},{romanji:"pyu",letter:"ぴゅ"},{romanji:"pyo",letter:"ぴょ"}]}]}],katakana:[{title:"Main",groups:[{title:"a",letters:[{letter:"ア",romanji:"a"},{letter:"イ",romanji:"i"},{letter:"ウ",romanji:"u"},{letter:"エ",romanji:"e"},{letter:"オ",romanji:"o"}]},{title:"k-",letters:[{letter:"カ",romanji:"ka"},{letter:"キ",romanji:"ki"},{letter:"ク",romanji:"ku"},{letter:"ケ",romanji:"ke"},{letter:"コ",romanji:"ko"}]},{title:"s-",letters:[{letter:"サ",romanji:"sa"},{letter:"シ",romanji:"shi"},{letter:"ス",romanji:"su"},{letter:"セ",romanji:"se"},{letter:"ソ",romanji:"so"}]},{title:"t-",letters:[{letter:"タ",romanji:"ta"},{letter:"チ",romanji:"chi"},{letter:"ツ",romanji:"tsu"},{letter:"テ",romanji:"te"},{letter:"ト",romanji:"to"}]},{title:"n-",letters:[{letter:"ナ",romanji:"na"},{letter:"ニ",romanji:"ni"},{letter:"ヌ",romanji:"nu"},{letter:"ネ",romanji:"ne"},{letter:"ノ",romanji:"no"}]},{title:"h-",letters:[{letter:"ハ",romanji:"ha"},{letter:"ヒ",romanji:"hi"},{letter:"フ",romanji:"fu"},{letter:"ヘ",romanji:"he"},{letter:"ホ",romanji:"ho"}]},{title:"m-",letters:[{letter:"マ",romanji:"ma"},{letter:"ミ",romanji:"mi"},{letter:"ム",romanji:"mu"},{letter:"メ",romanji:"me"},{letter:"モ",romanji:"mo"}]},{title:"y-",letters:[{letter:"ヤ",romanji:"ya"},{letter:"ユ",romanji:"yu"},{letter:"ヨ",romanji:"yo"}]},{title:"r-",letters:[{letter:"ラ",romanji:"ra"},{letter:"リ",romanji:"ri"},{letter:"ル",romanji:"ru"},{letter:"レ",romanji:"re"},{letter:"ロ",romanji:"ro"}]},{title:"w-",letters:[{letter:"ワ",romanji:"wa"},{letter:"ヲ",romanji:"wo"}]},{title:"n",letters:[{letter:"ン",romanji:"n"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{letter:"ガ",romanji:"ga"},{letter:"ギ",romanji:"gi"},{letter:"グ",romanji:"gu"},{letter:"ゲ",romanji:"ge"},{letter:"ゴ",romanji:"go"}]},{title:"z-",letters:[{letter:"ザ",romanji:"za"},{letter:"ジ",romanji:"zi"},{letter:"ズ",romanji:"zu"},{letter:"ゼ",romanji:"ze"},{letter:"ゾ",romanji:"zo"}]},{title:"d-",letters:[{letter:"ダ",romanji:"da"},{letter:"ヂ",romanji:"di"},{letter:"ヅ",romanji:"du"},{letter:"デ",romanji:"de"},{letter:"ド",romanji:"do"}]},{title:"b-",letters:[{letter:"バ",romanji:"ba"},{letter:"ビ",romanji:"bi"},{letter:"ブ",romanji:"bu"},{letter:"ベ",romanji:"be"},{letter:"ボ",romanji:"bo"}]},{title:"p-",letters:[{letter:"パ",romanji:"pa"},{letter:"ピ",romanji:"pi"},{letter:"プ",romanji:"pu"},{letter:"ペ",romanji:"pe"},{letter:"ポ",romanji:"po"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{letter:"キャ",romanji:"kya"},{letter:"キュ",romanji:"kyu"},{letter:"キョ",romanji:"kyo"}]},{title:"sh-",letters:[{letter:"シャ",romanji:"sha"},{letter:"シュ",romanji:"shu"},{letter:"ショ",romanji:"sho"}]},{title:"ch-",letters:[{letter:"チャ",romanji:"cha"},{letter:"チュ",romanji:"chu"},{letter:"チョ",romanji:"cho"}]},{title:"ny-",letters:[{letter:"ニャ",romanji:"nya"},{letter:"ニュ",romanji:"nyu"},{letter:"ニョ",romanji:"nyo"}]},{title:"hy-",letters:[{letter:"ヒャ",romanji:"hya"},{letter:"ヒュ",romanji:"hyu"},{letter:"ヒョ",romanji:"hyo"}]},{title:"my-",letters:[{letter:"ミャ",romanji:"mya"},{letter:"ミュ",romanji:"myu"},{letter:"ミョ",romanji:"myo"}]},{title:"ry-",letters:[{letter:"リャ",romanji:"rya"},{letter:"リュ",romanji:"ryu"},{letter:"リョ",romanji:"ryo"}]},{title:"gy-",letters:[{letter:"ギャ",romanji:"gya"},{letter:"ギュ",romanji:"gyu"},{letter:"ギョ",romanji:"gyo"}]},{title:"jy-",letters:[{letter:"jヤ",romanji:"jya"},{letter:"jユ",romanji:"jyu"},{letter:"jヨ",romanji:"jyo"}]},{title:"by-",letters:[{letter:"ビャ",romanji:"bya"},{letter:"ビュ",romanji:"byu"},{letter:"ビョ",romanji:"byo"}]},{title:"py-",letters:[{letter:"ピャ",romanji:"pya"},{letter:"ピュ",romanji:"pyu"},{letter:"ピョ ",romanji:"pyo"}]}]}]},ue={negative:["Nope!","Try again!","Not like this!"],positive:["Good job!","Correct!","Nice!"]};let x=0,y=Object.keys(h)[x];const ge=e=>{x=e,y=Object.keys(h)[x]},te=[{short:"TT",title:"Time Trials",description:"Limit how much time you have to name a character. 0 to disable"},{short:"KT",title:"Keep Trying",description:"Retry each character until you name it correctly"},{short:"PF",title:"Perfect",description:"Restart if you make a single mistake"},{short:"R",title:"Random",description:"Shuffle characters"},{short:"ZE",title:"Zen",description:"Just type the charactes, forever. Always random"}],je=[10,25,50,75,100],be=[["a","ka","sa","ta","na","ha","ma","ya","ra","wa","n"],["i","ki","shi","chi","ni","hi","mi","","ri","",""],["u","ku","su","tsu","nu","fu","mu","yu","ru","",""],["e","ke","se","te","ne","he","me","","re","",""],["o","ko","so","to","no","ho","mo","yo","ro","wo",""]],O=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let E=0;const Ee=["Tab","Escape","Enter"],L={},P={};let C=!1;const G=()=>{const e=document.getElementById("devTools"),t=document.getElementById("popupContainer");let r=!t.classList.contains("hidden")||!e.classList.contains("hidden");return t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.contains("hidden")||e.classList.add("hidden"),r},Te=()=>{document.addEventListener("keydown",e=>{for(const t of Object.keys(L[y]))Z==d.MAIN&&(e.key==t&&L[y][t](),t.startsWith("S")&&e.shiftKey&&e.key.toLowerCase()==t.charAt(1)&&L[y][t]());switch(Ee.includes(e.code)&&e.preventDefault(),Z){case d.MAIN:switch(e.code){case"Enter":G(),R();break;case"Escape":G();break;case"Space":Pe();break;case"F1":g(d.STATS);break;case"F2":N.classList.toggle("hidden");break;case"CapsLock":C&&he(),C=!C,document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>${C?"[Again]":"[Caps Lock]"}`;break}if(!N.classList.contains("hidden")&&e.code.startsWith("Digit")&&document.getElementById("TTSeconds")!=document.activeElement){const t=Number(e.code.slice(-1)),r=n=>{n.checked=!n.checked};if(t>4)return;if(r(document.getElementsByClassName(`Mod${t}`)[0]),t==4)for(let n=0;n<=3;n++)r(document.getElementsByClassName(`Mod${n}`)[0])}if(e.shiftKey&&e.code.startsWith("Digit")&&P[y][Number(e.code.slice(-1))](),!N.classList.contains("hidden")&&e.key=="`"){const t=document.getElementById("TTSeconds");t.focus(),t.value=t.value.replaceAll("`","")}break;case d.TEST:e.code=="Escape"&&(a.mods.includes("ZE")?V(a):g(d.MAIN));break;case d.RESULTS:switch(e.code){case"Tab":R();break;case"Escape":g(d.MAIN);break}break;case d.STATS:switch(e.code){case"F1":case"Escape":if(G())return;g(d.MAIN);break}break}E>0&&e.key!=O[E]&&(E=0),e.key==O[E]&&E++,E>=O.length&&(document.getElementById("devTools").classList.toggle("hidden"),E=0)})},j=new Set;let b="";function ke(e){const t=()=>{r.classList.toggle("selected")?j.add(e.title):(j.delete(e.title),r.parentElement.classList.remove("selected"))},r=document.createElement("div");r.classList.add("alphabetSubGroup");const n=document.createElement("p");return n.textContent=`${e.title} (${e.letters[0].letter})`,r.appendChild(n),r.addEventListener("click",()=>{t()}),e.title.length<3?L[b][e.title.charAt(0)]=t:L[b]["S"+e.title.charAt(0)]=t,r}function Le(e,t){const r=()=>{const s=n.classList.toggle("selected");for(const i of n.children)i.classList.contains("alphabetSubGroup")&&(s?(i.classList.add("selected"),j.add(i.children[0].innerHTML.split(" ")[0])):(i.classList.remove("selected"),j.delete(i.children[0].innerHTML.split(" ")[0])))},n=document.createElement("div");n.classList.add("alphabetGroup");const o=document.createElement("p");o.textContent=`${e.title} [Shift + ${t+1}]`,n.appendChild(o);for(const s of e.groups){const i=ke(s);n.appendChild(i)}return o.addEventListener("click",()=>{r()}),P[b][t+1]=r,n}function xe(e,t){const r=document.createElement("div");r.classList.add("alphabet"),r.id=`${e}Alphabet`,b=e,y!=e&&r.classList.add("hidden");const n=document.createElement("p");n.textContent=e,r.appendChild(n),L[b]||(L[b]={}),P[b]||(P[b]=[]);for(const o in t){const s=Le(t[o],Number(o));r.appendChild(s)}return r}const Ie=document.getElementById("content"),ve=document.getElementById("disclaimer");for(const e of Object.keys(h)){const t=xe(e,h[e]);Ie.insertBefore(t,ve)}window.onload=()=>{document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>[Caps Lock]`};const we=document.getElementById("modsScreen");for(const e in te){const t=te[e];if(t.short=="TT")continue;const r=document.createElement("div"),n=document.createElement("div"),o=document.createElement("p");o.innerHTML=t.title,n.append(o);const s=document.createElement("p");s.innerHTML=`[${Number(e)}]
${t.description}`,n.append(s),r.append(n);const i=document.createElement("input");i.type="checkbox",i.id=`${t.short}Selected`,i.classList.add(`Mod${Number(e)}`),r.append(i),we.append(r)}const A=e=>{let t=0;for(const r of e.history)t+=r.isCorrect?1:0;return t/e.history.length*100},Se=[{text:"F",longText:"Fail",condition:e=>e.failed},{text:"",longText:"",condition:e=>{if(window.forceX)return!0;if(j.size<25)return!1;for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"SS",longText:"Perfect",condition:e=>{for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"S",longText:"Almost there",condition:e=>A(e)>95},{text:"A",longText:"Good job",condition:e=>A(e)>90},{text:"B",longText:"Keep going",condition:e=>A(e)>80},{text:"C",longText:"I'm done with long text for now",condition:e=>A(e)>70},{text:"D",longText:"I'm done with long text for now",condition:()=>!0}],Be=[{text:"☆",condition:e=>!!e.mods?.includes("PF")},{text:"+",condition:e=>!!e.mods?.includes("KT")},{text:"꩜",condition:e=>!!e.mods?.includes("R")}],Me=[{text:"Ascended",style:"font-size: 2.5rem;font-weight: 900;letter-spacing: 2px;text-transform: uppercase;background: linear-gradient(270deg, #00ffe0, #ff00c8, #ffd700, #00ffe0);background-size: 800% 800%;-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: pulseGradient 6s ease infinite, glowPulse 2s ease-in-out infinite;text-shadow:0 0 10px rgba(255,255,255,0.9),0 0 20px rgba(0,255,255,0.6),0 0 30px rgba(255,0,255,0.6);border: 2px solid rgba(255,255,255,0.2);border-radius: 12px;padding: 0.5rem 1rem;box-shadow:0 0 15px rgba(255,255,255,0.1),0 0 25px rgba(0,255,255,0.3);display: inline-block;",condition:e=>!!(window.forceX||j.size>=25&&e.timeTrials&&e.timeTrials<=1&&e.mods.includes("PF")&&e.mods.includes("R")&&e.mods.includes("KT"))},{text:"Divine",style:"font-weight: 800;background: linear-gradient(90deg, #ff6ec4, #7873f5, #4ac29a);-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: shine 3s infinite linear;text-shadow: 0 0 8px rgba(255,255,255,0.6);",condition:e=>!!(e.timeTrials&&e.timeTrials<=2&&e.mods.includes("PF"))},{text:"Mythical",style:"color: crimson; font-weight: bold; text-shadow: 0 0 8px red;",condition:e=>!!(e.timeTrials&&e.timeTrials<=2.5&&e.mods.includes("PF"))},{text:"Godspeed",style:"color: #ff4081; font-style: italic; text-shadow: 0 0 5px #ff4081;",condition:e=>!!(e.timeTrials&&e.timeTrials<=3&&e.mods.includes("PF"))},{text:"Elite",style:"color: gold; font-weight: bold; text-shadow: 1px 1px 4px #b8860b;",condition:e=>!!(e.timeTrials&&e.timeTrials<=4&&e.mods.includes("PF"))},{text:"Sharp",style:"color: #4caf50; font-weight: 600; text-shadow: 0 0 5px #4caf50;",condition:e=>!!(e.timeTrials&&e.timeTrials<=5&&e.mods.includes("PF"))},{text:"Swift",style:"color: #00bcd4; font-style: italic;",condition:e=>!!(e.timeTrials&&e.timeTrials<=7&&e.mods.includes("PF"))},{text:"Quick",style:"color: #5bc0de; font-weight: bold;",condition:e=>!!(e.timeTrials&&e.timeTrials<=9&&e.mods.includes("PF"))},{text:"Casual",style:"color: gray;",condition:e=>!!(e.timeTrials&&e.timeTrials<=10&&e.mods.includes("PF"))}],Ce=(e,t)=>t.find(r=>r.character===e),X=e=>{let t=[];e[0]?t=t.concat(...e.map(o=>o.performance.map(s=>s.weight))):t=t.concat(...e.performance.map(o=>o.weight));const r=Math.min(...t);return{max:Math.max(5,...t),min:r}},re=(e,t)=>{const r=[];e.forEach(o=>{o.alphabet==t&&o.performance.forEach(s=>{const i=r.find(c=>c.character===s.character);i?(i.amount++,i.value+=s.weight):r.push({amount:1,value:Math.round(s.weight*100)/100,character:B("romanji",s.character,o.alphabet)})})});const n=X(e);return r.forEach(o=>{o.value=o.value/o.amount,o.value=Y(o.value,n.max,n.min)}),console.log(r),r},ne=(e,t,r)=>{const n=document.createElement("div");n.prepend(document.createElement("div")),be.forEach((o,s)=>{s==0&&o.forEach(i=>{const c=document.createElement("div");c.classList.add("heatmapHeader"),c.innerHTML=i.charAt(0),n.append(c)}),o.forEach((i,c)=>{if(c==0){const m=document.createElement("div");m.classList.add("heatmapHeader"),m.innerHTML=o[0].charAt(0),n.append(m)}const l=document.createElement("div");let u="transparent";if(l.innerHTML="",i!=""){const m=Ce(i,e);u=m?_(m.value):"var(--surface-2)",l.innerHTML=B("letter",i,t),m&&(l.title=""+m.value)}l.style.backgroundColor=u,n.append(l)})}),document.getElementById(r).appendChild(n)},Ae=e=>{const t=document.createElement("div");t.classList.add("run");const r=document.createElement("p");r.classList.add("runTimestamp"),r.innerHTML=new Date(e.timestamp).toLocaleString("en-GB"),t.append(r);const n=document.createElement("p");n.classList.add("runAlphabet"),n.innerHTML=h[e.alphabet][0].groups[0].letters[0].letter,t.append(n);const o=document.createElement("div");o.classList.add("runDetails");const s=X(e);e.performance.forEach(m=>{const F=Y(m.weight,s.max,s.min),I=document.createElement("p");I.style.color=_(F),I.innerHTML=m.character,I.title=`~${m.time}s`,m.mistakes>0&&(I.title=`X${m.mistakes} `+I.title),o.append(I)}),t.append(o);const i=document.createElement("p");i.classList.add("runRank");const c=D(e,!0);i.innerHTML=c.string,i.style=c.style,t.append(i);const l=document.createElement("p");l.classList.add("runStats");let u=0;e.history.forEach(m=>{u+=m.isCorrect?1:0}),u=u/e.history.length*100,l.innerHTML=`${u.toFixed(2)}% ${e.longestCombo}x`,t.append(l),document.getElementById("statsRuns").appendChild(t)},$e=()=>{document.getElementById("statsHeatmap").innerHTML="",document.getElementById("statsRuns").innerHTML=""},He=()=>{localStorage.getItem("statsInfoSeen")||(q(document.getElementById("statsNotice")),localStorage.setItem("statsInfoSeen","true")),$e();const e=Re();console.log(X(e)),ne(re(e,"hiragana"),"hiragana","statsHeatmap"),ne(re(e,"katakana"),"katakana","statsHeatmap"),e.forEach(t=>Ae(t)),Ne()},Ne=()=>{if(localStorage.getItem("profile")){const e=Fe(),t=document.getElementById("statsPfp");t.src=e.pfp;const r=document.getElementById("statsNickname");r.value=e.nickname;const n=document.getElementById("statsSlogan");n.value=e.slogan}},pe=e=>{let t=e.length;for(;t!=0;){let r=Math.floor(Math.random()*t);t--,[e[t],e[r]]=[e[r],e[t]]}},fe=e=>e[Math.floor(Math.random()*e.length)];var d=(e=>(e[e.MAIN=0]="MAIN",e[e.TEST=1]="TEST",e[e.RESULTS=2]="RESULTS",e[e.STATS=3]="STATS",e))(d||{});let Z=0;const oe=[document.getElementById("content"),document.getElementById("actualTest"),document.getElementById("resultsScreen"),document.getElementById("statsScreen")],g=e=>{oe.forEach(t=>{t?.classList.add("hidden")}),Z=e,oe[e]?.classList.remove("hidden"),e==3&&He()},B=(e,t,r)=>{r||(r=y);for(const n of h[r])for(const o of n.groups)for(const s of o.letters){if(e=="letter"&&s.romanji==t)return s.letter;if(e=="romanji"&&s.letter==t)return s.romanji}return"?"},D=(e,t)=>{let r="",n="";for(const o of Se)if(o.condition(e)){r=o.text;break}if(t)return{style:n,string:r};for(const o of Me){if(e.failed)break;if(o.condition(e)){r=`${o.text} ${r}`,n=o.style;break}}for(const o of Be){if(e.failed)break;if(r.startsWith("Ascended")){r.trimEnd();break}if(o.condition(e)){r=r+o.text;break}}return{style:n,string:r}},Pe=()=>{document.querySelector(".alphabetSubGroup")?.classList.contains("selected")?J("off"):J("on")},Q=()=>{const e=Object.keys(h),t=x+1>=e.length?0:x+1,r=h[y][0].groups[0].letters[0].letter,n=h[e[t]][0].groups[0].letters[0].letter;return`${r} -> ${n}`},J=e=>{document.querySelectorAll(".alphabetSubGroup").forEach(t=>{const r=t.children[0].innerHTML.split(" ")[0];e=="off"?(t.classList.remove("selected"),j.clear()):(t.classList.add("selected"),j.add(r))})},he=()=>{const e=Object.keys(h),t=x+1>e.length-1?0:x+1;ge(t),document.querySelectorAll(".alphabet").forEach(r=>{r.classList.add("hidden")}),document.getElementById(`${e[t]}Alphabet`).classList.remove("hidden"),j.clear(),J("off")},Re=()=>JSON.parse(localStorage.getItem("history")||"[]"),De=(e,t,r)=>{const n=JSON.parse(localStorage.getItem("history")||"[]");n.push({...e,performance:t,alphabet:r}),localStorage.setItem("history",JSON.stringify(n))},q=e=>{const t=document.getElementById("popupContainer");t.innerHTML="",t.appendChild(e),t.children[0].classList.remove("hidden"),t.classList.remove("hidden")},Fe=()=>(localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"})),JSON.parse(localStorage.getItem("profile"))),z=(e,t)=>{localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"}));const r=JSON.parse(localStorage.getItem("profile"));r[e]=t,localStorage.setItem("profile",JSON.stringify(r))};let T=[];const U=document.getElementById("resultsNotes"),Oe=document.getElementById("accuracyText"),ie=document.getElementById("resultsRank"),v=e=>{const{type:t,text:r,color:n,isPerfect:o}=e,s=t=="character"?0:1,i=document.createElement("p");i.innerHTML=r,n&&(i.style.color=n),o&&n&&(i.style.textShadow=`${n} 0 0 8px`),U.children[s].append(i)},Y=(e,t,r)=>t===r?0:(e-r)/(t-r),_=e=>{const c=Math.round(166+77*e),l=Math.round(227+-88*e),u=Math.round(161+7*e);return`rgb(${c},${l},${u})`},V=e=>{U.children[0].innerHTML="",U.children[1].innerHTML="",T=[],g(d.RESULTS),e.timestamp=Date.now();const t=D(e);if(ie.style=t.style,ie.innerHTML=t.string,e.failed){v({type:"note",text:"You failed"});return}let r={character:"none",mistakes:0};for(const i of Object.keys(e.characters)){const c=B("letter",i),l=e.characters[i];l.encounters||(l.encounters=1);const u=Math.max(l.time/1e3/(e.mods.includes("ZE")?l.encounters:1),.02),m=l.mistakes,F=Math.pow(u,1+Math.pow(m,1.5));T.push({key:i,character:c,mistakes:m,time:u,weight:F,encounters:l.encounters}),l.mistakes>r.mistakes&&(r={character:c,mistakes:l.mistakes})}De(e,T,y);const n=T.map(i=>i.weight),o=Math.min(...n),s=Math.max(5,...n);T.sort((i,c)=>i.weight-c.weight);for(const i of T){const c=Y(i.weight,s,o),l=_(c),u=((i.encounters-i.mistakes)/i.encounters*100).toFixed(2),m=i.mistakes>0?`(${i.encounters-i.mistakes}/${i.encounters})`:"";e.mods.includes("ZE")?v({type:"character",text:`${i.character}:  ~${i.time.toFixed(2)}s ${u}% ${m}`,color:l,isPerfect:i.mistakes<=0}):v({type:"character",text:`${i.character}: ${i.time.toFixed(2)}s ${i.mistakes>0?`(${i.mistakes}✗)`:""}`,color:l,isPerfect:i.mistakes<=0})}v({type:"note",text:`Max combo: ${e.longestCombo} ${r.mistakes==0?"(Full combo)":""}`}),v({type:"note",text:`Accuracy: ${Oe.innerHTML}`}),r.mistakes>0&&v({type:"note",text:`Hardest character: ${B("letter",r.character)} (${r.mistakes+1} tries)`}),console.log(e),console.log(T)},ae=document.getElementById("comboText"),se=document.getElementById("accuracyText"),le=document.getElementById("modsDisplay"),S=document.getElementById("actualTest").children[0],w=document.getElementById("resultsRank"),$=document.getElementById("resultsButtons"),Ge=document.getElementById("resultsNotes");let K=1e3;const W=e=>new Promise(t=>setTimeout(t,e)),ze=e=>{const t=document.createElement("p");t.innerHTML=e,t.style.opacity="0",t.classList.add("yes-transition"),t.classList.add("transcendedCharacter"),Ge.children[0].append(t),requestAnimationFrame(()=>{t.style.opacity="1"})},Ke=async e=>{ae.style.display="none",se.style.display="none",le.style.display="none",$.style.opacity="0%",$.classList.add("yes-transition"),w.style.opacity="0%",w.classList.add("yes-transition"),S.style.transition="all 2s ease-in-out",S.classList.add("transcendedCard"),S.style.opacity="0%",await W(2e3),g(d.RESULTS);for(const n of Object.keys(e.characters))ze(`${B("letter",n)}: Perfect`),await W(K),K=Math.max(200,K*.9);const t=D(e);w.style=t.style,w.innerHTML=t.string,w.style.opacity="100%",await W(1e3);const r=()=>{S.removeAttribute("style"),S.classList.remove("transcendedCard"),w.removeAttribute("style"),ae.removeAttribute("style"),se.removeAttribute("style"),le.removeAttribute("style")};$.style.opacity="100%",$.addEventListener("click",r)};let f=[],k=0,a={timestamp:0,history:[],startTime:0,currentCombo:0,longestCombo:0,characters:{},mods:[]};const M=document.getElementById("comboText"),ce=document.getElementById("accuracyText"),me=document.getElementById("resultsNotes"),de=document.getElementById("modsDisplay"),p=document.getElementById("current");let H;const R=()=>{f=[],k=0;for(const n of h[y])for(const o of n.groups)if(j.has(o.title))for(const s of o.letters)f.push(s);if(f.length==0){g(d.MAIN);return}me.children[0].innerHTML="",me.children[1].innerHTML="",a={timestamp:0,history:[],startTime:Date.now(),currentCombo:0,longestCombo:0,characters:{},mods:[]},["KT","PF","R","ZE"].forEach(n=>{document.getElementById(n+"Selected").checked&&a.mods?.push(n)});const e=Number(document.getElementById("TTSeconds").value);e>0&&(a.mods?.push("TT:"+e),a.timeTrials=e),(a.mods.includes("R")||a.mods.includes("ZE"))&&pe(f);const t=document.getElementById("actualTest").children[0],r=t.children[1];t.children[0].innerHTML=f[0].letter,r.value="",M.innerHTML="0x",M.classList="",de.innerHTML="",p.style.border="none",r.value="",a.mods?.forEach(n=>{const o=document.createElement("p");o.innerHTML=n,de?.append(o)}),t.classList.add("no-transition"),t.style.marginLeft="0%",t.offsetWidth,t.classList.remove("no-transition"),g(d.TEST),r.focus(),a.timeTrials&&(H=setTimeout(ee,a.timeTrials*1e3))};document.getElementById("romanjiInput").addEventListener("keydown",e=>{(e.code=="Space"||e.code=="Enter")&&ee()});const ye=(e,t)=>{const r=document.getElementById("actualTest"),n=document.createElement("p");n.classList.add("cheer"),n.innerHTML=t,n.style.color=e?"var(--red)":"var(--green)",n.style.opacity="100%",n.style.top="20%",r.append(n),requestAnimationFrame(()=>{n.style.opacity="0%",n.style.top="0%"}),n.addEventListener("transitionend",function o(){n.removeEventListener("transitionend",o),n.remove()})},ee=()=>{H&&clearTimeout(H);const e=p.children[1];let t=Date.now()-a.startTime;const r=f[k];a.characters[r.romanji]?a.characters[r.romanji].time+=t:a.characters[r.romanji]={time:t,mistakes:0},a.mods.includes("ZE")&&(a.characters[r.romanji].encounters?a.characters[r.romanji].encounters++:a.characters[r.romanji].encounters=1),a.startTime=Date.now();const o=e.value.replaceAll(" ","")==r.romanji;if(a.history.push({character:r.romanji,isCorrect:o}),o)Ze();else if(a.characters[r.romanji].mistakes++,We(),a.mods.includes("KT")){e.value="";return}let s=0;for(const i of a.history)s+=i.isCorrect?1:0;if(M.innerHTML=`${a.currentCombo}x`,je.includes(a.currentCombo)&&M.classList.add(`combo${a.currentCombo}`),ce.innerHTML=`${(s/a.history.length*100).toFixed(2)}%`,a.mods.includes("ZE")){let i=0;a.history.forEach(c=>{c.isCorrect||i++}),ce.innerHTML+=` (${a.history.length-i}/${a.history.length})`}if(k+1>=f.length&&D(a).string.startsWith("Ascended")||window.forceX){Ke(a);return}p.style.border=`1px solid var(--${o?"green":"red"})`,p.style.marginLeft="-110%",p.addEventListener("transitionend",function i(){if(p.removeEventListener("transitionend",i),k+1>=f.length)if(a.mods.includes("ZE"))k=0,pe(f);else{V(a);return}p.children[0].innerHTML=f[++k].letter,e.value="",e.focus(),p.classList.add("no-transition"),p.style.marginLeft="110%",p.style.border="none",p.offsetWidth,p.classList.remove("no-transition"),p.style.marginLeft="0%",a.timeTrials&&(H=setTimeout(ee,a.timeTrials*1e3))})},We=()=>{if(a.mods.includes("PF")&&(a.failed=!0,V(a)),ye(!0,fe(ue.negative)),a.currentCombo=0,M.classList="",a.mods.includes("KT"))return;const e=f[k];f.push(e)},Ze=()=>{ye(!1,fe(ue.positive)),a.currentCombo++,a.longestCombo<a.currentCombo&&(a.longestCombo=a.currentCombo)},Je=document.getElementById("helpPage"),N=document.getElementById("modsScreen"),qe=()=>{document.getElementById("startBtn").addEventListener("click",()=>{R()}),document.getElementById("helpBtn").addEventListener("click",()=>{q(Je)}),document.getElementById("statsBtn").addEventListener("click",()=>{g(d.STATS)}),document.getElementById("modsBtn").addEventListener("click",()=>{q(N)}),document.getElementById("alphabetBtn").addEventListener("click",()=>{he(),document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>[Caps Lock]`}),document.getElementById("resultsRetryBtn").addEventListener("click",()=>{R()}),document.getElementById("resultsBackBtn").addEventListener("click",()=>{g(d.MAIN)}),document.getElementById("wipeHistory").addEventListener("click",()=>{localStorage.removeItem("history")}),document.getElementById("devForceAscend").addEventListener("click",()=>{window.forceX=!0}),document.getElementById("resetStatsPopup").addEventListener("click",()=>{localStorage.removeItem("statsInfoSeen")}),document.getElementById("wipeProfile").addEventListener("click",()=>{localStorage.removeItem("profile")}),document.getElementById("statsPfp").addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.onchange=t=>{const r=e.files[0],n=new FileReader;n.onload=()=>{const o=n.result;document.getElementById("statsPfp").src=""+o,z("pfp",""+o),console.log(o)},n.readAsDataURL(r)},e.click()}),document.getElementById("statsNickname").addEventListener("change",()=>{z("nickname",document.getElementById("statsNickname").value)}),document.getElementById("statsSlogan").addEventListener("change",()=>{z("slogan",document.getElementById("statsSlogan").value)})};qe();Te();
