(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const y={hiragana:[{title:"Main",groups:[{title:"a",letters:[{romanji:"a",letter:"あ"},{romanji:"i",letter:"い"},{romanji:"u",letter:"う"},{romanji:"e",letter:"え"},{romanji:"o",letter:"お"}]},{title:"k-",letters:[{romanji:"ka",letter:"か"},{romanji:"ki",letter:"き"},{romanji:"ku",letter:"く"},{romanji:"ke",letter:"け"},{romanji:"ko",letter:"こ"}]},{title:"s-",letters:[{romanji:"sa",letter:"さ"},{romanji:"shi",letter:"し"},{romanji:"su",letter:"す"},{romanji:"se",letter:"せ"},{romanji:"so",letter:"そ"}]},{title:"t-",letters:[{romanji:"ta",letter:"た"},{romanji:"chi",letter:"ち"},{romanji:"tsu",letter:"つ"},{romanji:"te",letter:"て"},{romanji:"to",letter:"と"}]},{title:"n-",letters:[{romanji:"na",letter:"な"},{romanji:"ni",letter:"に"},{romanji:"nu",letter:"ぬ"},{romanji:"ne",letter:"ね"},{romanji:"no",letter:"の"}]},{title:"h-",letters:[{romanji:"ha",letter:"は"},{romanji:"hi",letter:"ひ"},{romanji:"fu",letter:"ふ"},{romanji:"he",letter:"へ"},{romanji:"ho",letter:"ほ"}]},{title:"m-",letters:[{romanji:"ma",letter:"ま"},{romanji:"mi",letter:"み"},{romanji:"mu",letter:"む"},{romanji:"me",letter:"め"},{romanji:"mo",letter:"も"}]},{title:"y-",letters:[{romanji:"ya",letter:"や"},{romanji:"yu",letter:"ゆ"},{romanji:"yo",letter:"よ"}]},{title:"r-",letters:[{romanji:"ra",letter:"ら"},{romanji:"ri",letter:"り"},{romanji:"ru",letter:"る"},{romanji:"re",letter:"れ"},{romanji:"ro",letter:"ろ"}]},{title:"w-",letters:[{romanji:"wa",letter:"わ"},{romanji:"wo",letter:"を"}]},{title:"n",letters:[{romanji:"n",letter:"ん"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{romanji:"ga",letter:"が"},{romanji:"gi",letter:"ぎ"},{romanji:"gu",letter:"ぐ"},{romanji:"ge",letter:"げ"},{romanji:"go",letter:"ご"}]},{title:"z-",letters:[{romanji:"za",letter:"ざ"},{romanji:"ji",letter:"じ"},{romanji:"zu",letter:"ず"},{romanji:"ze",letter:"ぜ"},{romanji:"zo",letter:"ぞ"}]},{title:"d-",letters:[{romanji:"da",letter:"だ"},{romanji:"di",letter:"ぢ"},{romanji:"du",letter:"づ"},{romanji:"de",letter:"で"},{romanji:"do",letter:"ど"}]},{title:"b-",letters:[{romanji:"ba",letter:"ば"},{romanji:"bi",letter:"び"},{romanji:"bu",letter:"ぶ"},{romanji:"be",letter:"べ"},{romanji:"bo",letter:"ぼ"}]},{title:"p-",letters:[{romanji:"pa",letter:"ぱ"},{romanji:"pi",letter:"ぴ"},{romanji:"pu",letter:"ぷ"},{romanji:"pe",letter:"ぺ"},{romanji:"po",letter:"ぽ"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{romanji:"kya",letter:"きゃ"},{romanji:"kyu",letter:"きゅ"},{romanji:"kyo",letter:"きょ"}]},{title:"sh-",letters:[{romanji:"sha",letter:"しゃ"},{romanji:"shu",letter:"しゅ"},{romanji:"sho",letter:"しょ"}]},{title:"ch-",letters:[{romanji:"cha",letter:"ちゃ"},{romanji:"chu",letter:"ちゅ"},{romanji:"cho",letter:"ちょ"}]},{title:"ny-",letters:[{romanji:"nya",letter:"にゃ"},{romanji:"nyu",letter:"にゅ"},{romanji:"nyo",letter:"にょ"}]},{title:"hy-",letters:[{romanji:"hya",letter:"ひゃ"},{romanji:"hyu",letter:"ひゅ"},{romanji:"hyo",letter:"ひょ"}]},{title:"my-",letters:[{romanji:"mya",letter:"みゃ"},{romanji:"myu",letter:"みゅ"},{romanji:"myo",letter:"みょ"}]},{title:"ry-",letters:[{romanji:"rya",letter:"りゃ"},{romanji:"ryu",letter:"りゅ"},{romanji:"ryo",letter:"りょ"}]},{title:"gy-",letters:[{romanji:"gya",letter:"ぎょ"},{romanji:"gyu",letter:"ぎゅ"},{romanji:"gyo",letter:"ぎょ"}]},{title:"jy-",letters:[{romanji:"jya",letter:"じゃ"},{romanji:"jyu",letter:"じゅ"},{romanji:"jyo",letter:"じょ"}]},{title:"by-",letters:[{romanji:"bya",letter:"びゃ"},{romanji:"byu",letter:"びゅ"},{romanji:"byo",letter:"びょ"}]},{title:"py-",letters:[{romanji:"pya",letter:"ぴゃ"},{romanji:"pyu",letter:"ぴゅ"},{romanji:"pyo",letter:"ぴょ"}]}]}],katakana:[{title:"Main",groups:[{title:"a",letters:[{letter:"ア",romanji:"a"},{letter:"イ",romanji:"i"},{letter:"ウ",romanji:"u"},{letter:"エ",romanji:"e"},{letter:"オ",romanji:"o"}]},{title:"k-",letters:[{letter:"カ",romanji:"ka"},{letter:"キ",romanji:"ki"},{letter:"ク",romanji:"ku"},{letter:"ケ",romanji:"ke"},{letter:"コ",romanji:"ko"}]},{title:"s-",letters:[{letter:"サ",romanji:"sa"},{letter:"シ",romanji:"shi"},{letter:"ス",romanji:"su"},{letter:"セ",romanji:"se"},{letter:"ソ",romanji:"so"}]},{title:"t-",letters:[{letter:"タ",romanji:"ta"},{letter:"チ",romanji:"chi"},{letter:"ツ",romanji:"tsu"},{letter:"テ",romanji:"te"},{letter:"ト",romanji:"to"}]},{title:"n-",letters:[{letter:"ナ",romanji:"na"},{letter:"ニ",romanji:"ni"},{letter:"ヌ",romanji:"nu"},{letter:"ネ",romanji:"ne"},{letter:"ノ",romanji:"no"}]},{title:"h-",letters:[{letter:"ハ",romanji:"ha"},{letter:"ヒ",romanji:"hi"},{letter:"フ",romanji:"fu"},{letter:"ヘ",romanji:"he"},{letter:"ホ",romanji:"ho"}]},{title:"m-",letters:[{letter:"マ",romanji:"ma"},{letter:"ミ",romanji:"mi"},{letter:"ム",romanji:"mu"},{letter:"メ",romanji:"me"},{letter:"モ",romanji:"mo"}]},{title:"y-",letters:[{letter:"ヤ",romanji:"ya"},{letter:"ユ",romanji:"yu"},{letter:"ヨ",romanji:"yo"}]},{title:"r-",letters:[{letter:"ラ",romanji:"ra"},{letter:"リ",romanji:"ri"},{letter:"ル",romanji:"ru"},{letter:"レ",romanji:"re"},{letter:"ロ",romanji:"ro"}]},{title:"w-",letters:[{letter:"ワ",romanji:"wa"},{letter:"ヲ",romanji:"wo"}]},{title:"n",letters:[{letter:"ン",romanji:"n"}]}]},{title:"Modified",groups:[{title:"g-",letters:[{letter:"ガ",romanji:"ga"},{letter:"ギ",romanji:"gi"},{letter:"グ",romanji:"gu"},{letter:"ゲ",romanji:"ge"},{letter:"ゴ",romanji:"go"}]},{title:"z-",letters:[{letter:"ザ",romanji:"za"},{letter:"ジ",romanji:"zi"},{letter:"ズ",romanji:"zu"},{letter:"ゼ",romanji:"ze"},{letter:"ゾ",romanji:"zo"}]},{title:"d-",letters:[{letter:"ダ",romanji:"da"},{letter:"ヂ",romanji:"di"},{letter:"ヅ",romanji:"du"},{letter:"デ",romanji:"de"},{letter:"ド",romanji:"do"}]},{title:"b-",letters:[{letter:"バ",romanji:"ba"},{letter:"ビ",romanji:"bi"},{letter:"ブ",romanji:"bu"},{letter:"ベ",romanji:"be"},{letter:"ボ",romanji:"bo"}]},{title:"p-",letters:[{letter:"パ",romanji:"pa"},{letter:"ピ",romanji:"pi"},{letter:"プ",romanji:"pu"},{letter:"ペ",romanji:"pe"},{letter:"ポ",romanji:"po"}]}]},{title:"Combined",groups:[{title:"ky-",letters:[{letter:"キャ",romanji:"kya"},{letter:"キュ",romanji:"kyu"},{letter:"キョ",romanji:"kyo"}]},{title:"sh-",letters:[{letter:"シャ",romanji:"sha"},{letter:"シュ",romanji:"shu"},{letter:"ショ",romanji:"sho"}]},{title:"ch-",letters:[{letter:"チャ",romanji:"cha"},{letter:"チュ",romanji:"chu"},{letter:"チョ",romanji:"cho"}]},{title:"ny-",letters:[{letter:"ニャ",romanji:"nya"},{letter:"ニュ",romanji:"nyu"},{letter:"ニョ",romanji:"nyo"}]},{title:"hy-",letters:[{letter:"ヒャ",romanji:"hya"},{letter:"ヒュ",romanji:"hyu"},{letter:"ヒョ",romanji:"hyo"}]},{title:"my-",letters:[{letter:"ミャ",romanji:"mya"},{letter:"ミュ",romanji:"myu"},{letter:"ミョ",romanji:"myo"}]},{title:"ry-",letters:[{letter:"リャ",romanji:"rya"},{letter:"リュ",romanji:"ryu"},{letter:"リョ",romanji:"ryo"}]},{title:"gy-",letters:[{letter:"ギャ",romanji:"gya"},{letter:"ギュ",romanji:"gyu"},{letter:"ギョ",romanji:"gyo"}]},{title:"jy-",letters:[{letter:"jヤ",romanji:"jya"},{letter:"jユ",romanji:"jyu"},{letter:"jヨ",romanji:"jyo"}]},{title:"by-",letters:[{letter:"ビャ",romanji:"bya"},{letter:"ビュ",romanji:"byu"},{letter:"ビョ",romanji:"byo"}]},{title:"py-",letters:[{letter:"ピャ",romanji:"pya"},{letter:"ピュ",romanji:"pyu"},{letter:"ピョ ",romanji:"pyo"}]}]}]},ue={negative:["Nope!","Try again!","Not like this!"],positive:["Good job!","Correct!","Nice!"]};let L=0,g=Object.keys(y)[L];const je=e=>{L=e,g=Object.keys(y)[L]},te=[{short:"TT",title:"Time Trials",description:"Limit how much time you have to name a character. 0 to disable"},{short:"KT",title:"Keep Trying",description:"Retry each character until you name it correctly"},{short:"PF",title:"Perfect",description:"Restart if you make a single mistake"},{short:"R",title:"Random",description:"Shuffle characters"},{short:"ZE",title:"Zen",description:"Just type the charactes, forever. Always random"}],be=[10,25,50,75,100],Ee=[["a","ka","sa","ta","na","ha","ma","ya","ra","wa","n"],["i","ki","shi","chi","ni","hi","mi","","ri","",""],["u","ku","su","tsu","nu","fu","mu","yu","ru","",""],["e","ke","se","te","ne","he","me","","re","",""],["o","ko","so","to","no","ho","mo","yo","ro","wo",""]],G=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];let E=0;const Te=["Tab","Escape","Enter"],k={},P={};let A=!1;const z=()=>{const e=document.getElementById("devTools"),t=document.getElementById("popupContainer");let n=!t.classList.contains("hidden")||!e.classList.contains("hidden");return t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.contains("hidden")||e.classList.add("hidden"),n},ke=()=>{document.addEventListener("keydown",e=>{for(const t of Object.keys(k[g]))q==u.MAIN&&(e.key==t&&k[g][t](),t.startsWith("S")&&e.shiftKey&&e.key.toLowerCase()==t.charAt(1)&&k[g][t]());switch(Te.includes(e.code)&&e.preventDefault(),q){case u.MAIN:switch(e.code){case"Enter":z(),D();break;case"Escape":z();break;case"Space":Re();break;case"F1":h(u.STATS);break;case"F2":N.classList.toggle("hidden");break;case"CapsLock":A&&he(),A=!A,document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>${A?"[Again]":"[Caps Lock]"}`;break}if(!N.classList.contains("hidden")&&e.code.startsWith("Digit")&&document.getElementById("TTSeconds")!=document.activeElement){const t=Number(e.code.slice(-1)),n=r=>{r.checked=!r.checked};if(t>4)return;if(n(document.getElementsByClassName(`Mod${t}`)[0]),t==4)for(let r=0;r<=3;r++)n(document.getElementsByClassName(`Mod${r}`)[0])}if(e.shiftKey&&e.code.startsWith("Digit")&&P[g][Number(e.code.slice(-1))](),!N.classList.contains("hidden")&&e.key=="`"){const t=document.getElementById("TTSeconds");t.focus(),t.value=t.value.replaceAll("`","")}break;case u.TEST:e.code=="Escape"&&(s.mods.includes("ZE")?_(s):h(u.MAIN));break;case u.RESULTS:switch(e.code){case"Tab":D();break;case"Escape":h(u.MAIN);break}break;case u.STATS:switch(e.code){case"F1":case"Escape":if(z())return;h(u.MAIN);break}break}E>0&&e.key!=G[E]&&(E=0),e.key==G[E]&&E++,E>=G.length&&(document.getElementById("devTools").classList.toggle("hidden"),E=0)})},j=new Set;let b="";function Le(e){const t=()=>{n.classList.toggle("selected")?j.add(e.title):(j.delete(e.title),n.parentElement.classList.remove("selected"))},n=document.createElement("div");n.classList.add("alphabetSubGroup");const r=document.createElement("p");return r.textContent=`${e.title} (${e.letters[0].letter})`,n.appendChild(r),n.addEventListener("click",()=>{t()}),e.title.length<3?k[b][e.title.charAt(0)]=t:k[b]["S"+e.title.charAt(0)]=t,n}function xe(e,t){const n=()=>{const a=r.classList.toggle("selected");for(const i of r.children)i.classList.contains("alphabetSubGroup")&&(a?(i.classList.add("selected"),j.add(i.children[0].innerHTML.split(" ")[0])):(i.classList.remove("selected"),j.delete(i.children[0].innerHTML.split(" ")[0])))},r=document.createElement("div");r.classList.add("alphabetGroup");const o=document.createElement("p");o.textContent=`${e.title} [Shift + ${t+1}]`,r.appendChild(o);for(const a of e.groups){const i=Le(a);r.appendChild(i)}return o.addEventListener("click",()=>{n()}),P[b][t+1]=n,r}function ve(e,t){const n=document.createElement("div");n.classList.add("alphabet"),n.id=`${e}Alphabet`,b=e,g!=e&&n.classList.add("hidden");const r=document.createElement("p");r.textContent=e,n.appendChild(r),k[b]||(k[b]={}),P[b]||(P[b]=[]);for(const o in t){const a=xe(t[o],Number(o));n.appendChild(a)}return n}const Ie=document.getElementById("content"),we=document.getElementById("disclaimer");for(const e of Object.keys(y)){const t=ve(e,y[e]);Ie.insertBefore(t,we)}window.onload=()=>{document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>[Caps Lock]`};const Se=document.getElementById("modsScreen");for(const e in te){const t=te[e];if(t.short=="TT")continue;const n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("p");o.innerHTML=t.title,r.append(o);const a=document.createElement("p");a.innerHTML=`[${Number(e)}]
${t.description}`,r.append(a),n.append(r);const i=document.createElement("input");i.type="checkbox",i.id=`${t.short}Selected`,i.classList.add(`Mod${Number(e)}`),n.append(i),Se.append(n)}const C=e=>{let t=0;for(const n of e.history)t+=n.isCorrect?1:0;return t/e.history.length*100},Be=[{text:"F",longText:"Fail",condition:e=>e.failed},{text:"",longText:"",condition:e=>{if(window.forceX)return!0;if(j.size<25)return!1;for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"SS",longText:"Perfect",condition:e=>{for(const t of Object.keys(e.characters))if(e.characters[t].mistakes>0)return!1;return!0}},{text:"S",longText:"Almost there",condition:e=>C(e)>95},{text:"A",longText:"Good job",condition:e=>C(e)>90},{text:"B",longText:"Keep going",condition:e=>C(e)>80},{text:"C",longText:"I'm done with long text for now",condition:e=>C(e)>70},{text:"D",longText:"I'm done with long text for now",condition:()=>!0}],Me=[{text:"☆",condition:e=>!!e.mods?.includes("PF")},{text:"+",condition:e=>!!e.mods?.includes("KT")},{text:"꩜",condition:e=>!!e.mods?.includes("R")}],Ae=[{text:"Ascended",style:"font-size: 2.5rem;font-weight: 900;letter-spacing: 2px;text-transform: uppercase;background: linear-gradient(270deg, #00ffe0, #ff00c8, #ffd700, #00ffe0);background-size: 800% 800%;-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: pulseGradient 6s ease infinite, glowPulse 2s ease-in-out infinite;text-shadow:0 0 10px rgba(255,255,255,0.9),0 0 20px rgba(0,255,255,0.6),0 0 30px rgba(255,0,255,0.6);border: 2px solid rgba(255,255,255,0.2);border-radius: 12px;padding: 0.5rem 1rem;box-shadow:0 0 15px rgba(255,255,255,0.1),0 0 25px rgba(0,255,255,0.3);display: inline-block;",condition:e=>!!(window.forceX||j.size>=25&&e.timeTrials&&e.timeTrials<=1&&e.mods.includes("PF")&&e.mods.includes("R")&&e.mods.includes("KT"))},{text:"Divine",style:"font-weight: 800;background: linear-gradient(90deg, #ff6ec4, #7873f5, #4ac29a);-webkit-background-clip: text;-webkit-text-fill-color: transparent;animation: shine 3s infinite linear;text-shadow: 0 0 8px rgba(255,255,255,0.6);",condition:e=>!!(e.timeTrials&&e.timeTrials<=2&&e.mods.includes("PF"))},{text:"Mythical",style:"color: crimson; font-weight: bold; text-shadow: 0 0 8px red;",condition:e=>!!(e.timeTrials&&e.timeTrials<=2.5&&e.mods.includes("PF"))},{text:"Godspeed",style:"color: #ff4081; font-style: italic; text-shadow: 0 0 5px #ff4081;",condition:e=>!!(e.timeTrials&&e.timeTrials<=3&&e.mods.includes("PF"))},{text:"Elite",style:"color: gold; font-weight: bold; text-shadow: 1px 1px 4px #b8860b;",condition:e=>!!(e.timeTrials&&e.timeTrials<=4&&e.mods.includes("PF"))},{text:"Sharp",style:"color: #4caf50; font-weight: 600; text-shadow: 0 0 5px #4caf50;",condition:e=>!!(e.timeTrials&&e.timeTrials<=5&&e.mods.includes("PF"))},{text:"Swift",style:"color: #00bcd4; font-style: italic;",condition:e=>!!(e.timeTrials&&e.timeTrials<=7&&e.mods.includes("PF"))},{text:"Quick",style:"color: #5bc0de; font-weight: bold;",condition:e=>!!(e.timeTrials&&e.timeTrials<=9&&e.mods.includes("PF"))},{text:"Casual",style:"color: gray;",condition:e=>!!(e.timeTrials&&e.timeTrials<=10&&e.mods.includes("PF"))}],Ce=(e,t)=>t.find(n=>n.character===e),W=(e,t)=>{let n=[];switch(e){case"run":n=n.concat(...t.performance.map(a=>a.weight));break;case"heatmapValue":n=n.concat(...t.map(a=>a.value));break;case"heatmapAmount":n=n.concat(...t.map(a=>a.amount));break}let r=Math.min(...n);return e=="heatmapAmount"&&(r=r*.75),{max:Math.max(...n),min:r}},ne=(e,t)=>{const n=[];e.forEach(a=>{if(a.longestCombo==0){Fe(a.timestamp);return}a.alphabet==t&&a.performance.forEach(i=>{const m=n.find(l=>l.character===S("romanji",i.character,a.alphabet));m?(m.amount++,m.value+=i.weight):n.push({amount:1,value:i.weight,character:S("romanji",i.character,a.alphabet)})})});const r=W("heatmapValue",n),o=W("heatmapAmount",n);return n.forEach(a=>{a.value=R(a.value,r.max,r.min),a.amount=R(a.amount,o.max,o.min)}),n},re=(e,t,n)=>{const r=document.createElement("div");r.prepend(document.createElement("div")),Ee.forEach((o,a)=>{a==0&&o.forEach(i=>{const m=document.createElement("div");m.classList.add("heatmapHeader"),m.innerHTML=i.charAt(0),r.append(m)}),o.forEach((i,m)=>{if(m==0){const c=document.createElement("div");c.classList.add("heatmapHeader"),c.innerHTML=o[0].charAt(0),r.append(c)}const l=document.createElement("div");let p="transparent";if(l.innerHTML="",i!=""){const c=Ce(i,e);p=c?Y(c.value):"var(--surface-2)",l.style.transform=`scale(${c?c.amount:1})`,l.innerHTML=S("letter",i,t),c&&(l.title=`value:${1-c.value}, encounter rate:${c.amount}`)}l.style.backgroundColor=p,r.append(l)})}),document.getElementById(n).appendChild(r)},$e=e=>{const t=document.createElement("div");t.classList.add("run");const n=document.createElement("p");n.classList.add("runTimestamp"),n.innerHTML=new Date(e.timestamp).toLocaleString("en-GB"),t.append(n);const r=document.createElement("p");r.classList.add("runAlphabet"),r.innerHTML=y[e.alphabet][0].groups[0].letters[0].letter,t.append(r);const o=document.createElement("div");o.classList.add("runDetails");const a=W("run",e);e.performance.forEach(c=>{const O=R(c.weight,a.max,a.min),x=document.createElement("p");x.style.color=Y(O),x.innerHTML=c.character,x.title=`~${c.time}s`,c.mistakes>0&&(x.title=`X${c.mistakes} `+x.title),o.append(x)}),t.append(o);const i=document.createElement("p");i.classList.add("runRank");const m=F(e,!0);i.innerHTML=m.string,i.style=m.style,t.append(i);const l=document.createElement("p");l.classList.add("runStats");let p=0;e.history.forEach(c=>{p+=c.isCorrect?1:0}),p=p/e.history.length*100,l.innerHTML=`${p.toFixed(2)}% ${e.longestCombo}x`,t.append(l),document.getElementById("statsRuns").prepend(t)},He=()=>{document.getElementById("statsHeatmap").innerHTML="",document.getElementById("statsRuns").innerHTML=""},Ne=()=>{localStorage.getItem("statsInfoSeen")||(X(document.getElementById("statsNotice")),localStorage.setItem("statsInfoSeen","true")),He();const e=ye();re(ne(e,"hiragana"),"hiragana","statsHeatmap"),re(ne(e,"katakana"),"katakana","statsHeatmap"),e.forEach(t=>$e(t)),Pe()},Pe=()=>{if(localStorage.getItem("profile")){const e=Oe(),t=document.getElementById("statsPfp");t.src=e.pfp;const n=document.getElementById("statsNickname");n.value=e.nickname;const r=document.getElementById("statsSlogan");r.value=e.slogan}},pe=e=>{let t=e.length;for(;t!=0;){let n=Math.floor(Math.random()*t);t--,[e[t],e[n]]=[e[n],e[t]]}},fe=e=>e[Math.floor(Math.random()*e.length)];var u=(e=>(e[e.MAIN=0]="MAIN",e[e.TEST=1]="TEST",e[e.RESULTS=2]="RESULTS",e[e.STATS=3]="STATS",e))(u||{});let q=0;const oe=[document.getElementById("content"),document.getElementById("actualTest"),document.getElementById("resultsScreen"),document.getElementById("statsScreen")],h=e=>{oe.forEach(t=>{t?.classList.add("hidden")}),q=e,oe[e]?.classList.remove("hidden"),e==3&&Ne()},S=(e,t,n)=>{n||(n=g);for(const r of y[n])for(const o of r.groups)for(const a of o.letters){if(e=="letter"&&a.romanji==t)return a.letter;if(e=="romanji"&&a.letter==t)return a.romanji}return"?"},F=(e,t)=>{let n="",r="";for(const o of Be)if(o.condition(e)){n=o.text;break}if(t)return{style:r,string:n};for(const o of Ae){if(e.failed)break;if(o.condition(e)){n=`${o.text} ${n}`,r=o.style;break}}for(const o of Me){if(e.failed)break;if(n.startsWith("Ascended")){n.trimEnd();break}if(o.condition(e)){n=n+o.text;break}}return{style:r,string:n}},Re=()=>{document.querySelector(".alphabetSubGroup")?.classList.contains("selected")?U("off"):U("on")},Q=()=>{const e=Object.keys(y),t=L+1>=e.length?0:L+1,n=y[g][0].groups[0].letters[0].letter,r=y[e[t]][0].groups[0].letters[0].letter;return`${n} -> ${r}`},U=e=>{document.querySelectorAll(".alphabetSubGroup").forEach(t=>{const n=t.children[0].innerHTML.split(" ")[0];e=="off"?(t.classList.remove("selected"),j.clear()):(t.classList.add("selected"),j.add(n))})},he=()=>{const e=Object.keys(y),t=L+1>e.length-1?0:L+1;je(t),document.querySelectorAll(".alphabet").forEach(n=>{n.classList.add("hidden")}),document.getElementById(`${e[t]}Alphabet`).classList.remove("hidden"),j.clear(),U("off")},ye=()=>JSON.parse(localStorage.getItem("history")||"[]"),De=(e,t,n)=>{const r=JSON.parse(localStorage.getItem("history")||"[]");r.push({...e,performance:t,alphabet:n}),localStorage.setItem("history",JSON.stringify(r))},Fe=e=>{const t=ye(),n=[];t.forEach(r=>{r.timestamp!=e&&n.push(r)}),localStorage.setItem("history",JSON.stringify(n))},X=e=>{const t=document.getElementById("popupContainer");t.innerHTML="",t.appendChild(e),t.children[0].classList.remove("hidden"),t.classList.remove("hidden")},Oe=()=>(localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"})),JSON.parse(localStorage.getItem("profile"))),K=(e,t)=>{localStorage.getItem("profile")||localStorage.setItem("profile",JSON.stringify({pfp:"https://placehold.co/400",nickname:"nickname",slogan:"slogan"}));const n=JSON.parse(localStorage.getItem("profile"));n[e]=t,localStorage.setItem("profile",JSON.stringify(n))};let v=[];const V=document.getElementById("resultsNotes"),Ge=document.getElementById("accuracyText"),ie=document.getElementById("resultsRank"),I=e=>{const{type:t,text:n,color:r,isPerfect:o}=e,a=t=="character"?0:1,i=document.createElement("p");i.innerHTML=n,r&&(i.style.color=r),o&&r&&(i.style.textShadow=`${r} 0 0 8px`),V.children[a].append(i)},R=(e,t,n)=>t===n?0:(e-n)/(t-n),Y=e=>{const m=Math.round(166+77*e),l=Math.round(227+-88*e),p=Math.round(161+7*e);return`rgb(${m},${l},${p})`},_=e=>{if(e.mods.includes("ZE")&&e.longestCombo<1){h(u.MAIN);return}V.children[0].innerHTML="",V.children[1].innerHTML="",v=[],h(u.RESULTS),e.timestamp=Date.now();const t=F(e);if(ie.style=t.style,ie.innerHTML=t.string,e.failed){I({type:"note",text:"You failed"});return}let n={character:"none",mistakes:0};for(const i of Object.keys(e.characters)){const m=S("letter",i),l=e.characters[i];l.encounters||(l.encounters=1);const p=Math.max(l.time/1e3/(e.mods.includes("ZE")?l.encounters:1),.02),c=l.mistakes,O=Math.pow(p,1+Math.pow(c,1.5));v.push({key:i,character:m,mistakes:c,time:p,weight:O,encounters:l.encounters}),l.mistakes>n.mistakes&&(n={character:m,mistakes:l.mistakes})}De(e,v,g);const r=v.map(i=>i.weight),o=Math.min(...r),a=Math.max(5,...r);v.sort((i,m)=>i.weight-m.weight);for(const i of v){const m=R(i.weight,a,o),l=Y(m),p=((i.encounters-i.mistakes)/i.encounters*100).toFixed(2),c=i.mistakes>0?`(${i.encounters-i.mistakes}/${i.encounters})`:"";e.mods.includes("ZE")?I({type:"character",text:`${i.character}:  ~${i.time.toFixed(2)}s ${p}% ${c}`,color:l,isPerfect:i.mistakes<=0}):I({type:"character",text:`${i.character}: ${i.time.toFixed(2)}s ${i.mistakes>0?`(${i.mistakes}✗)`:""}`,color:l,isPerfect:i.mistakes<=0})}I({type:"note",text:`Max combo: ${e.longestCombo} ${n.mistakes==0?"(Full combo)":""}`}),I({type:"note",text:`Accuracy: ${Ge.innerHTML}`}),n.mistakes>0&&I({type:"note",text:`Hardest character: ${S("letter",n.character)} (${n.mistakes+1} tries)`})},ae=document.getElementById("comboText"),se=document.getElementById("accuracyText"),le=document.getElementById("modsDisplay"),B=document.getElementById("actualTest").children[0],w=document.getElementById("resultsRank"),$=document.getElementById("resultsButtons"),ze=document.getElementById("resultsNotes");let Z=1e3;const J=e=>new Promise(t=>setTimeout(t,e)),Ke=e=>{const t=document.createElement("p");t.innerHTML=e,t.style.opacity="0",t.classList.add("yes-transition"),t.classList.add("transcendedCharacter"),ze.children[0].append(t),requestAnimationFrame(()=>{t.style.opacity="1"})},Ze=async e=>{ae.style.display="none",se.style.display="none",le.style.display="none",$.style.opacity="0%",$.classList.add("yes-transition"),w.style.opacity="0%",w.classList.add("yes-transition"),B.style.transition="all 2s ease-in-out",B.classList.add("transcendedCard"),B.style.opacity="0%",await J(2e3),h(u.RESULTS);for(const r of Object.keys(e.characters))Ke(`${S("letter",r)}: Perfect`),await J(Z),Z=Math.max(200,Z*.9);const t=F(e);w.style=t.style,w.innerHTML=t.string,w.style.opacity="100%",await J(1e3);const n=()=>{B.removeAttribute("style"),B.classList.remove("transcendedCard"),w.removeAttribute("style"),ae.removeAttribute("style"),se.removeAttribute("style"),le.removeAttribute("style")};$.style.opacity="100%",$.addEventListener("click",n)};let f=[],T=0,s={timestamp:0,history:[],startTime:0,currentCombo:0,longestCombo:0,characters:{},mods:[]};const M=document.getElementById("comboText"),ce=document.getElementById("accuracyText"),me=document.getElementById("resultsNotes"),de=document.getElementById("modsDisplay"),d=document.getElementById("current");let H;const D=()=>{f=[],T=0;for(const r of y[g])for(const o of r.groups)if(j.has(o.title))for(const a of o.letters)f.push(a);if(f.length==0){h(u.MAIN);return}me.children[0].innerHTML="",me.children[1].innerHTML="",s={timestamp:0,history:[],startTime:Date.now(),currentCombo:0,longestCombo:0,characters:{},mods:[]},["KT","PF","R","ZE"].forEach(r=>{document.getElementById(r+"Selected").checked&&s.mods?.push(r)});const e=Number(document.getElementById("TTSeconds").value);e>0&&(s.mods?.push("TT:"+e),s.timeTrials=e),(s.mods.includes("R")||s.mods.includes("ZE"))&&pe(f);const t=document.getElementById("actualTest").children[0],n=t.children[1];t.children[0].innerHTML=f[0].letter,n.value="",M.innerHTML="0x",M.classList="",de.innerHTML="",d.style.border="none",n.value="",s.mods?.forEach(r=>{const o=document.createElement("p");o.innerHTML=r,de?.append(o)}),t.classList.add("no-transition"),t.style.marginLeft="0%",t.offsetWidth,t.classList.remove("no-transition"),h(u.TEST),n.focus(),s.timeTrials&&(H=setTimeout(ee,s.timeTrials*1e3))};document.getElementById("romanjiInput").addEventListener("keydown",e=>{(e.code=="Space"||e.code=="Enter")&&ee()});const ge=(e,t)=>{const n=document.getElementById("actualTest"),r=document.createElement("p");r.classList.add("cheer"),r.innerHTML=t,r.style.color=e?"var(--red)":"var(--green)",r.style.opacity="100%",r.style.top="20%",n.append(r),requestAnimationFrame(()=>{r.style.opacity="0%",r.style.top="0%"}),r.addEventListener("transitionend",function o(){r.removeEventListener("transitionend",o),r.remove()})},ee=()=>{H&&clearTimeout(H);const e=d.children[1];let t=Date.now()-s.startTime;const n=f[T],r=s.characters[n.romanji];if(e.value=e.value.replaceAll(" ",""),e.value==""){qe();return}r?s.characters[n.romanji].time+=t:s.characters[n.romanji]={time:t,mistakes:0},s.mods.includes("ZE")&&(s.characters[n.romanji].encounters?s.characters[n.romanji].encounters++:s.characters[n.romanji].encounters=1),s.startTime=Date.now();const o=e.value.replaceAll(" ","")==n.romanji;if(s.history.push({character:n.romanji,isCorrect:o}),o)We();else if(s.characters[n.romanji].mistakes++,Je(),s.mods.includes("KT")){e.value="";return}let a=0;for(const i of s.history)a+=i.isCorrect?1:0;if(M.innerHTML=`${s.currentCombo}x`,be.includes(s.currentCombo)&&M.classList.add(`combo${s.currentCombo}`),ce.innerHTML=`${(a/s.history.length*100).toFixed(2)}%`,s.mods.includes("ZE")){let i=0;s.history.forEach(m=>{m.isCorrect||i++}),ce.innerHTML+=` (${s.history.length-i}/${s.history.length})`}if(T+1>=f.length&&F(s).string.startsWith("Ascended")||window.forceX){Ze(s);return}d.style.border=`1px solid var(--${o?"green":"red"})`,d.style.marginLeft="-110%",d.addEventListener("transitionend",function i(){if(d.removeEventListener("transitionend",i),T+1>=f.length)if(s.mods.includes("ZE"))T=0,pe(f);else{_(s);return}d.children[0].innerHTML=f[++T].letter,e.value="",e.focus(),d.classList.add("no-transition"),d.style.marginLeft="110%",d.style.border="none",d.offsetWidth,d.classList.remove("no-transition"),d.style.marginLeft="0%",s.timeTrials&&(H=setTimeout(ee,s.timeTrials*1e3))})},Je=()=>{if(s.mods.includes("PF")&&(s.failed=!0,_(s)),ge(!0,fe(ue.negative)),s.currentCombo=0,M.classList="",s.mods.includes("KT"))return;const e=f[T];f.push(e)},We=()=>{ge(!1,fe(ue.positive)),s.currentCombo++,s.longestCombo<s.currentCombo&&(s.longestCombo=s.currentCombo)},qe=()=>{d.classList.add("maybe-transition"),d.style.marginLeft="-5%",d.addEventListener("transitionend",function e(){d.removeEventListener("transitionend",e),d.style.marginLeft="5%",d.addEventListener("transitionend",function t(){d.removeEventListener("transitionend",t),d.style.marginLeft="0%",d.classList.remove("maybe-transition")})})},Ue=document.getElementById("helpPage"),N=document.getElementById("modsScreen"),Xe=()=>{document.getElementById("startBtn").addEventListener("click",()=>{D()}),document.getElementById("helpBtn").addEventListener("click",()=>{X(Ue)}),document.getElementById("statsBtn").addEventListener("click",()=>{h(u.STATS)}),document.getElementById("modsBtn").addEventListener("click",()=>{X(N)}),document.getElementById("alphabetBtn").addEventListener("click",()=>{he(),document.getElementById("alphabetBtn").innerHTML=`${Q()}<br>[Caps Lock]`}),document.getElementById("resultsRetryBtn").addEventListener("click",()=>{D()}),document.getElementById("resultsBackBtn").addEventListener("click",()=>{h(u.MAIN)}),document.getElementById("wipeHistory").addEventListener("click",()=>{localStorage.removeItem("history")}),document.getElementById("devForceAscend").addEventListener("click",()=>{window.forceX=!0}),document.getElementById("resetStatsPopup").addEventListener("click",()=>{localStorage.removeItem("statsInfoSeen")}),document.getElementById("wipeProfile").addEventListener("click",()=>{localStorage.removeItem("profile")}),document.getElementById("statsPfp").addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.onchange=t=>{const n=e.files[0],r=new FileReader;r.onload=()=>{const o=r.result;document.getElementById("statsPfp").src=""+o,K("pfp",""+o)},r.readAsDataURL(n)},e.click()}),document.getElementById("statsNickname").addEventListener("change",()=>{K("nickname",document.getElementById("statsNickname").value)}),document.getElementById("statsSlogan").addEventListener("change",()=>{K("slogan",document.getElementById("statsSlogan").value)})};Xe();ke();
